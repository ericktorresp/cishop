{include file="pageheader.html"}
<script src="js/jquery.js"></script>
<script type="text/javascript" src="./js/jquery.impromptu.2.6.min.js"></script>
<LINK href="./css/impromptu.css" rel="stylesheet" type="text/css" />
<script>
jQuery(document).ready(function(){
    $("#checkall").click(function(){
        $(":input").attr("checked",$("#checkall").attr("checked"));
    });
});
function cancel()
{
	if($(":input[name='taskid[]'][checked=true]").size()==0)
	{
		alert("您没有选择选择彩种期数.");
		return false;
	}
	else
	{
		var sCharge = ""; // 每一期撤单手续费
		var temp; // 分解数据
		var html = ""; // 显示数据
		var fTotalFee = 0; // 手续费总额
		var count = 0;   // 统计
		var tempCharge = "";
		// 计算终止追号时，应当收取多少手续费
		$(":input[name='taskid[]'][checked=true]").each(function(){
			temp = this.value.split("#");
			temp[1] = Number(temp[1]).toFixed(2);
			fTotalFee += parseFloat(temp[1]);
			if (temp[1] > 0){
				sCharge += "<tr align='center' bgcolor='b5bac5'><td>" + temp[2] + "</td><td>" + temp[1] + "元</td></tr>";
				count++;
			}
		});
		if (count > 1){
			times = window.setTimeout("change()");
			if ({$need} === 1){
				html += "<div style='overflow-y: auto; height: 200px; width: 100%;'><table width='100%' border='0' cellpadding='0' cellspacing='5' bgcolor='#FFFFFF'><tr><td bgcolor='#b5bac5'><table width='100%' border='0' cellpadding='2' cellspacing='1' bgcolor='#b5bac5'><tr><td colspan='2' style='padding:5px'>真的要中止追号任务吗？  将收取撤单手续金额:</td></tr><tr align='center' bgcolor='#666666' style='color:#FFFFFF'><td>奖期</td><td>撤单手续费</td></tr>" + sCharge + "<tr align='center' bgcolor='b5bac5'><td>总计</td><td>" + fTotalFee + "元</td></tr>";
			} else {
				html += "<div style='overflow-y: auto; height: 80px; width: 100%;'><table width='100%' border='0' cellpadding='0' cellspacing='5' bgcolor='#FFFFFF'><tr><td bgcolor='#b5bac5'><table width='100%' border='0' cellpadding='2' cellspacing='1' bgcolor='#b5bac5'><tr><td colspan='2'>真的要中止追号任务吗？" + tempCharge + "</td></tr>";
			}
		} else {
			times = window.setTimeout("change()");
			if (fTotalFee > 0 && {$need} === 1 ){
				tempCharge = "<br /><br /><span id='notice_color'>撤消此单将收取撤单手续费金额: " + fTotalFee + " 元</span>";
			}
			html += "<div style='overflow-y: auto; height: 80px; width: 100%;'><table width='100%' border='0' cellpadding='0' cellspacing='5' bgcolor='#FFFFFF'><tr><td bgcolor='#b5bac5'><table width='100%' border='0' cellpadding='2' cellspacing='1' bgcolor='#b5bac5'><tr><td colspan='2'>真的要中止追号任务吗？" + tempCharge + "</td></tr>";
		}
		html += "</table></td></tr></table></div>";
		$.prompt(html,{ buttons: { "确认": true, "取消": false }, callback:mycallbackform,focus: 1 });
	}
}

function change(){
	var node  = document.getElementById("notice_color");//#33FF33
	if (node != null){
		str = node.style.color.toLowerCase();
	  	node.style.color = str == "#ff1100" || str == "rgb(255, 17, 0)" ? "#000000" : "#FF1100"; 
	  	times = window.setTimeout("change()",1000);
	}
}

function mycallbackform(v,m,f){
	clearTimeout(times);
	if(v){
			$("#Form").submit();
	}
}
</script>
<div class="list-div">
<table>
<tr>
<td class="narrow-label">追号编号</td>
<td>{$task.taskid|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">游戏用户</td>
<td>{$task.username|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">追号时间</td>
<td>{$task.begintime|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">游戏</td>
<td>{$task.cnname|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">玩法</td>
<td>{$task.methodname|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">追号内容</td>
<td>{$task.codes}</td>
</tr>
<tr>
<td class="narrow-label">开始期号</td>
<td>{$task.beginissue|escape:html}</td>
</tr>
<tr>
<td class="narrow-label">追号期数</td>
<td>{$task.issuecount|escape:html}期</td>
</tr>
<tr>
<td class="narrow-label">完成期数</td>
<td>{$task.finishedcount|escape:html}期</td>
</tr>
<tr>
<td class="narrow-label">取消期数</td>
<td>{$task.cancelcount|escape:html}期</td>
</tr>
<tr>
<td class="narrow-label">追号总金额</td>
<td>{$task.taskprice|escape:money}</td>
</tr>
<tr>
<td class="narrow-label">完成金额</td>
<td>{$task.finishprice|escape:money}</td>
</tr>
<tr>
<td class="narrow-label">取消金额</td>
<td>{$task.cancelprice|escape:money}</td>
</tr>
<tr>
<td class="narrow-label">中奖后终止任务</td>
<td>{if $task.stoponwin==1}是{else}否{/if}</td>
</tr>
<tr>
<td class="narrow-label">追号状态</td>
<td>{if $task.status==0}进行中{elseif $task.status==1}已取消{elseif $task.status==2}已完成{/if}</td>
</tr>
<tr>
<td class="narrow-label"></td>
<td><input type="button" class="button" value="关闭" onclick="self.close();">
{if $task.status==0}
<input type="button" class="button" value="追号终止" onclick="cancel()">
{/if}</td>
</tr>
</table>
</div>
<br/>
<div class="list-div">
<form id="Form" action="./?controller=gameinfo&action=canceltask" method="post">
<input type="hidden" name="id" value="{$task.taskid}" />
<table>
<tr>
<th><input type="checkbox" id="checkall">奖期</th>
<th>追号倍数</th>
<th>追号状态</th>
<th>注单详情</th>
</tr>
{foreach from=$aTaskdetail item=taskdetail key=k}
<tr align="center">
<td>{if $taskdetail.status<2}
{if strtotime($taskdetail.canneldeadline)>time()}
<input type="checkbox" name="taskid[]" value="{$taskdetail.entry}#{$taskdetail.fee}#{$taskdetail.issue}">
{/if}
{/if}{$taskdetail.issue|escape:html}</td>
<td>{$taskdetail.multiple|escape:html}倍</td>
<td>{if $taskdetail.status==0}进行中{elseif $taskdetail.status==1}已完成{elseif $taskdetail.status==2}已取消{/if}</td>
<td>{if $taskdetail.projectid}<a href="index.php?controller=gameinfo&action=gamedetail&id={$taskdetail.projectid}">详情</a>{/if}</td>
</tr>
{/foreach}
</table>
</form>
</div>
{include file="pagefooter.html"}