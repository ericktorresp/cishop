(function(a){a.fn.loterryTraceArea=function(b){b=a.extend({},a.lotteryUI.defaults.traceDefault,b||{});var j="<table border='0' cellpadding='0' cellspacing='0' style='width:100%;'>";j+="<tr><td height='30' align='left'>&nbsp;&nbsp;<input type='checkbox' name='trace_check' id='trace_check' value='1' /><input type='hidden' name='lottery_istrace' id='lottery_istrace' value='0'><input type='hidden' name='trace_totalamount' id='trace_totalamount' value='0'> "+lottery_lang.tip_t_t1+"&nbsp;&nbsp;&nbsp;<input type='checkbox' name='trace_stop' id='trace_stop' value='1' disabled /> "+lottery_lang.tip_t_t2+"</td></tr>";j+="<tr><td align='center' id='trace_content_area' style='display:none;'><input type='hidden' name='trace_type' id='trace_type' value='sametimes'>";j+="<table class='"+b.label_css+"' cellpadding='0' cellspacing='0'><tr><td class='"+b.label_space_css+"'>&nbsp;</td>";a.each(b.selectype,function(o,p){if(o==0){labelcss=b.label_front_css}else{labelcss=b.label_back_css}switch(p){case"sametimes":j+="<td class='"+labelcss+"' id='trace_label_sametimes'>"+lottery_lang.tip_t_t3+"</td><td class='"+b.label_space_css+"'>&nbsp;</td>";break;case"difftimes":j+="<td class='"+labelcss+"' id='trace_label_difftimes'>"+lottery_lang.tip_t_t4+"</td><td class='"+b.label_space_css+"'>&nbsp;</td>";break;case"profit":j+="<td class='"+labelcss+"' id='trace_label_profit'>"+lottery_lang.tip_t_t5+"</td><td class='"+b.label_space_css+"'>&nbsp;</td>";break;case"margin":j+="<td class='"+labelcss+"' id='trace_label_margin'>"+lottery_lang.tip_t_t6+"</td><td class='"+b.label_space_css+"'>&nbsp;</td>";break;default:break}});j+="<td class='"+b.label_line_css+"'>&nbsp;</td></tr></table>";j+="<table class='"+b.table_css+"' cellpadding='0' cellspacing='0' style='border-top:0;'><tr><td align='center' style='border-right:0;' valign='middle'>";a.each(b.selectype,function(o,p){if(o==0){dispaly=""}else{dispaly="style='display:none;'"}switch(p){case"sametimes":j+="<div class='"+b.label_content_css+"' id='trace_label_sametimes_text' "+dispaly+">"+lottery_lang.tip_t_t7+":<input type='text' class='"+b.input_css+"' name='trace_sametimes' id='trace_sametimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t8+":<input type='text' class='"+b.input_css+"' name='trace_issues_sametimes' id='trace_issues_sametimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t9+": <span class='"+b.money_css+"'>0</span> "+lottery_lang.tip_c_yxb+"</div>";break;case"difftimes":j+="<div class='"+b.label_content_css+"' id='trace_label_difftimes_text' "+dispaly+">"+lottery_lang.tip_t_t10+" <input type='text' class='"+b.input_css+"' name='trace_step_difftimes' id='trace_step_difftimes' /> "+lottery_lang.tip_t_t11+"&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t7+" \u00d7 <input type='text' class='"+b.input_css+"' name='trace_difftimes' id='trace_difftimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t12+":<input type='text' class='"+b.input_css+"' name='trace_issues_difftimes' id='trace_issues_difftimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t9+": <span class='"+b.money_css+"'>0</span> "+lottery_lang.tip_c_yxb+"</div>";break;case"profit":j+="<div class='"+b.label_content_css+"' id='trace_label_profit_text' "+dispaly+">"+lottery_lang.tip_t_t13+": <input type='text' class='"+b.input_css+"' name='trace_profittimes' id='trace_profittimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t8+":<input type='text' class='"+b.input_css+"' name='trace_issues_profit' id='trace_issues_profit' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t14+":<input type='text' class='"+b.input_css+"' name='trace_profit_min' id='trace_profit_min' /> "+lottery_lang.tip_c_yxb+"&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t9+": <span class='"+b.money_css+"'>0</span> "+lottery_lang.tip_c_yxb+"</div>";break;case"margin":j+="<div class='"+b.label_content_css+"' id='trace_label_margin_text' "+dispaly+">"+lottery_lang.tip_t_t13+": <input type='text' class='"+b.input_css+"' name='trace_margintimes' id='trace_margintimes' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t8+":<input type='text' class='"+b.input_css+"' name='trace_issues_margin' id='trace_issues_margin' />&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t15+":<input type='text' class='"+b.input_css+"' name='trace_margin_min' id='trace_margin_min' value='50' /> %&nbsp;&nbsp;&nbsp;&nbsp;"+lottery_lang.tip_t_t9+": <span class='"+b.money_css+"'>0</span> "+lottery_lang.tip_c_yxb+"</div>";break;default:break}});j+="</td><td align='center' width='100'>";if(b.button_image==""){j+="<button type='button' class='"+b.button_css+"' id='trace_button'>"+b.button_text+"</button>"}else{j+="<img src='"+b.button_image+"' class='"+b.button_css+"' alt='"+b.button_text+"' id='trace_button' style='cursor:pointer;' />"}j+="</td></tr></table>";j+="<div style='height:200px;overflow:auto;overflow-x:hidden;'><table class='"+b.table_css+"' cellpadding='0' cellspacing='0' style='width:97%;' id='trace_detail'><tr><td colspan='6' align='center' bgcolor='#FF6666' class='lottery_tracearea_wordtitle'>"+lottery_lang.tip_t_t16+"</td></tr><tr><td height='20' class='titletd'>"+lottery_lang.tip_t_t17+"</td><td class='titletd'>"+lottery_lang.tip_t_t7+"</td><td class='titletd'>"+lottery_lang.tip_t_t18+"</td><td class='titletd'>"+lottery_lang.tip_t_t19+"</td><td class='titletd'>"+lottery_lang.tip_t_t20+"</td><td class='titletd'>"+lottery_lang.tip_t_t21+"</td></tr>";var c=b.periods.length;a.fn.lottery_periodArr=[];for(i=0;i<c;i++){if(b.periods[i]!=""){a.fn.lottery_periodArr.push({issue:b.periods[i],ischecked:false,times:0,money_buy:0,money_prize:0,money_profit:0,money_percent:0});j+="<tr><td height='20'><input type='checkbox' name='trace_issue[]' value='"+b.periods[i]+"'> "+b.periods[i]+"</td><td><input type='text' class='"+b.input_css+"' name='trace_times_"+b.periods[i]+"' value='0' disabled> "+lottery_lang.tip_c_time2+"</td><td><span class='trace_money_buy'>0</span> "+lottery_lang.tip_c_yxb+"</td><td><span class='trace_money_prize'>0</span> "+lottery_lang.tip_c_yxb+"</td><td><span class='trace_money_profit'>0</span> "+lottery_lang.tip_c_yxb+"</td><td><span class='trace_money_precent'>0</span> %</td></tr>"}}j+="</table></div>";j+="</td></tr>";j+="</table>";a(j).appendTo(this);a("#trace_check").click(function(){if(a(this).attr("checked")==true){a("#trace_stop").attr("disabled",false).attr("checked",true);a("#lottery_istrace").val(1);a("#trace_content_area").show()}else{a("#trace_stop").attr("disabled",true).attr("checked",false);a("#lottery_istrace").val(0);a("#trace_content_area").hide()}});a("input[type='text'][name^='trace']").keyup(function(){a(this).val(Number(a(this).val().replace(/[^0-9]/g,"0")))});function h(o){var p;try{p=a.fn.lottery_option.prize.toString().split(".")[1].length}catch(q){p=0}return Math.round(Number(o)*Math.pow(10,p))/Math.pow(10,p)}function g(q,t,r){var p=a.fn.lottery_option.price;var s=a.fn.lottery_option.prize;var o=[{buy:0,prize:0,profit:0,percent:0}];q=q?Math.round(Number(q)):0;t=t?Math.round(Number(t)):0;r=r?Math.round(Number(r)):0;if(q>0&&t>0){o.buy=p*q*t;o.prize=h(s*t);o.profit=h(o.prize-o.buy-r);o.percent=Math.round(o.profit*100/(o.buy+r))}else{o.buy=0;o.prize=0;o.profit=0;o.percent=0}return o}function d(r,u,p,s){var q=a.fn.lottery_option.price;var t=a.fn.lottery_option.prize;var o=[{times:0,buy:0,prize:0,profit:0,percent:0}];r=r?Math.round(Number(r)):0;p=p?Math.round(Number(p)):0;s=s?Math.round(Number(s)):0;u=u?Math.round(Number(u)):1;if(r>0){if(p>=0){o.times=Math.ceil((p+s)/(t-q*r))}else{o.times=1}if(o.times<u){o.times=u}o.buy=q*r*o.times;o.prize=h(t*o.times);o.profit=h(o.prize-o.buy-s);o.percent=Math.round(o.profit*100/(o.buy+s))}else{o.times=0;o.buy=0;o.prize=0;o.profit=0;o.percent=0}return o}function k(q,u,s,r){var p=a.fn.lottery_option.price;var t=a.fn.lottery_option.prize;var o=[{times:0,buy:0,prize:0,profit:0,percent:0}];q=q?Math.round(Number(q)):0;s=s?Math.round(Number(s)):0;r=r?Math.round(Number(r)):0;u=u?Math.round(Number(u)):1;if(q>0){if(s>=0){o.times=Math.ceil((r*(s/100+1))/(t-(s/100+1)*q*p))}else{o.times=1}if(o.times<u){o.times=u}o.buy=p*q*o.times;o.prize=h(t*o.times);o.profit=h(o.prize-o.buy-r);o.percent=Math.round(o.profit*100/(o.buy+r))}else{o.times=0;o.buy=0;o.prize=0;o.profit=0;o.percent=0}return o}function f(){traceType=a("#trace_type").val().toLowerCase();var p=0;var o=0;a.each(a.fn.lottery_periodArr,function(q,r){if(r.ischecked==true){o+=1;p+=Number(r.money_buy)}});a("#trace_label_"+traceType+"_text").find("span").html(p);a("#trace_issues_"+traceType).val(o);a("#trace_totalamount").val(p)}a("#trace_button").click(function(){traceType=a("#trace_type").val().toLowerCase();var A=a.fn.lottery_no_count;var y=a.fn.lottery_option.price;var x=a.fn.lottery_option.prize;if(A<=0){a.alert(lottery_lang.msg_trace_t1);return false}if(traceType!="sametimes"&&traceType!="difftimes"&&y*A>x){a.alert(lottery_lang.msg_trace_t2);return false}if(a.inArray(traceType,["sametimes","difftimes","profit","margin"])!=-1){var s=Number(a("#trace_issues_"+traceType).val());if(s>=b.periods.length){a.alert(lottery_lang.msg_trace_t3+":"+(b.periods.length-1));return false}var t=a.fn.lottery_periodArr.length;var C=false;var z="";if(s<=0){a.alert(lottery_lang.msg_trace_t4);return false}switch(traceType){case"sametimes":var p=Number(a("#trace_sametimes").val());if(p<=0){C=true;z=lottery_lang.msg_trace_t5;break}var D=0;var B=0;var w=[];for(i=0;i<t;i++){w=g(A,p,D);D+=w.buy;if(i<s){B+=w.buy}a.fn.lottery_periodArr[i].times=p;a.fn.lottery_periodArr[i].money_buy=w.buy;a.fn.lottery_periodArr[i].money_prize=w.prize;a.fn.lottery_periodArr[i].money_profit=w.profit;a.fn.lottery_periodArr[i].money_percent=w.percent}z=lottery_lang.msg_trace_t6.replace("[times]",p);break;case"difftimes":var r=Number(a("#trace_step_difftimes").val());var v=Number(a("#trace_difftimes").val());if(r<=0){C=true;z=lottery_lang.msg_trace_t7;break}if(v<=0){C=true;z=lottery_lang.msg_trace_t5;break}var p=1;var D=0;var B=0;var w=[];for(i=0;i<t;i++){if(i!=0&&(i%(r))==0){p*=v}w=g(A,p,D);D+=w.buy;if(i<s){B+=w.buy}a.fn.lottery_periodArr[i].times=p;a.fn.lottery_periodArr[i].money_buy=w.buy;a.fn.lottery_periodArr[i].money_prize=w.prize;a.fn.lottery_periodArr[i].money_profit=w.profit;a.fn.lottery_periodArr[i].money_percent=w.percent}z=lottery_lang.msg_trace_t8.replace("[trace_step]",r).replace("[times_step]",v);break;case"profit":var q=Number(a("#trace_profittimes").val());var o=Number(a("#trace_profit_min").val());if(o<=0){C=true;z=lottery_lang.msg_trace_t9;break}var D=0;var B=0;var w=[];for(i=0;i<t;i++){w=d(A,q,o,D);D+=w.buy;if(i<s){B+=w.buy}a.fn.lottery_periodArr[i].times=w.times;a.fn.lottery_periodArr[i].money_buy=w.buy;a.fn.lottery_periodArr[i].money_prize=w.prize;a.fn.lottery_periodArr[i].money_profit=w.profit;a.fn.lottery_periodArr[i].money_percent=w.percent}z=lottery_lang.msg_trace_t10.replace("[minprofit]",o).replace("[startTime]",q);break;case"margin":var q=Number(a("#trace_margintimes").val());var u=Number(a("#trace_margin_min").val());if(u>=((x*100)/(y*A)-100)){C=true;z=lottery_lang.msg_trace_t11;break}var D=0;var B=0;var w=[];for(i=0;i<t;i++){w=k(A,q,u,D);D+=w.buy;if(i<s){B+=w.buy}a.fn.lottery_periodArr[i].times=w.times;a.fn.lottery_periodArr[i].money_buy=w.buy;a.fn.lottery_periodArr[i].money_prize=w.prize;a.fn.lottery_periodArr[i].money_profit=w.profit;a.fn.lottery_periodArr[i].money_percent=w.percent}z=lottery_lang.msg_trace_t12.replace("[minmargin]",u).replace("[startTime]",q);break}if(B>a.fn.lottery_option.money){C=true;z=lottery_lang.msg_trace_t13}if(C==true){a.alert(z);return false}a.confirm({message:z+lottery_lang.msg_trace_t14.replace("[issuecount]",s),funyes:function(){a("input[name^='trace_issue']",a("#trace_detail")).each(function(E,F){if(E<s){m(F)}else{l(F)}});f()},funno:function(){a.cleanTrace()}})}else{a.alert(lottery_lang.action_error);return false}});function m(p){var o=a.fn.lottery_periodArr.length;for(i=0;i<o;i++){if(a(p).val()==a.fn.lottery_periodArr[i].issue){a.fn.lottery_periodArr[i].ischecked=true;a(p).parent().parent().find("input[name^='trace_times_']").attr("disabled",false).val(a.fn.lottery_periodArr[i].times);a(p).parent().parent().find("span[class^='trace_money']").each(function(q,r){switch(a(this).attr("class")){case"trace_money_buy":a(this).html(a.fn.lottery_periodArr[i].money_buy);break;case"trace_money_prize":a(this).html(a.fn.lottery_periodArr[i].money_prize);break;case"trace_money_profit":a(this).html(a.fn.lottery_periodArr[i].money_profit);break;case"trace_money_precent":a(this).html(a.fn.lottery_periodArr[i].money_percent);break;default:break}});break}}a(p).attr("checked",true);b.fun_select(a(p).parent().parent())}function l(p){a(p).parent().parent().find("input[name^='trace_times_']").attr("disabled",true).val(0);a(p).parent().parent().find("span[class^='trace_money']").each(function(q,r){a(this).html(0)});var o=a.fn.lottery_periodArr.length;for(i=0;i<o;i++){if(a(p).val()==a.fn.lottery_periodArr[i].issue){a.fn.lottery_periodArr[i].ischecked=false;break}}a(p).attr("checked",false);b.fun_unselect(a(p).parent().parent())}a("input[name^='trace_issue']",a("#trace_detail")).click(function(){if(a(this).attr("checked")==true){m(this)}else{l(this)}f()});a("input[name^='trace_times_']",a("#trace_detail")).keyup(function(){var o=a.fn.lottery_periodArr.length;var r=a.fn.lottery_no_count;var q=a.fn.lottery_option.price;var t=a.fn.lottery_option.prize;var s=0;var p=[];for(i=0;i<o;i++){if(a(this).parent().parent().find("input[name^='trace_issue']").val()==a.fn.lottery_periodArr[i].issue){a.fn.lottery_periodArr[i].ischecked=true;if(Number(a(this).val())<=0){a(this).val(a.fn.lottery_periodArr[i].times);a.alert(lottery_lang.msg_trace_t15);break;return false}a.fn.lottery_periodArr[i].times=Number(a(this).val());p=g(r,a.fn.lottery_periodArr[i].times,s);s+=p.buy;a.fn.lottery_periodArr[i].money_buy=p.buy;a.fn.lottery_periodArr[i].money_prize=p.prize;a.fn.lottery_periodArr[i].money_profit=p.profit;a.fn.lottery_periodArr[i].money_percent=p.percent;a(this).parent().parent().find("span[class^='trace_money']").each(function(u,v){switch(a(this).attr("class")){case"trace_money_buy":a(this).html(a.fn.lottery_periodArr[i].money_buy);break;case"trace_money_prize":a(this).html(a.fn.lottery_periodArr[i].money_prize);break;case"trace_money_profit":a(this).html(a.fn.lottery_periodArr[i].money_profit);break;case"trace_money_precent":a(this).html(a.fn.lottery_periodArr[i].money_percent);break;default:break}});i++;break}else{if(a.fn.lottery_periodArr[i].ischecked==true){s+=a.fn.lottery_periodArr[i].money_buy}}}for(i;i<o;i++){p=g(r,a.fn.lottery_periodArr[i].times,s);s+=p.buy;a.fn.lottery_periodArr[i].money_buy=p.buy;a.fn.lottery_periodArr[i].money_prize=p.prize;a.fn.lottery_periodArr[i].money_profit=p.profit;a.fn.lottery_periodArr[i].money_percent=p.percent;if(a.fn.lottery_periodArr[i].ischecked==true){m(a("input[name^='trace_issue'][value='"+a.fn.lottery_periodArr[i].issue+"']",a("#trace_detail")))}}f()});function n(o){a(o).attr("class",b.label_front_css);a(o+"_text").show()}function e(o){a(o).attr("class",b.label_back_css);a(o+"_text").hide()}a("#trace_label_sametimes").css("cursor","pointer").click(function(){n("#trace_label_sametimes");e("#trace_label_difftimes");e("#trace_label_profit");e("#trace_label_margin");if(a("#trace_type").val()!="sametimes"){a("#trace_type").val("sametimes");a.cleanTrace()}});a("#trace_label_difftimes").css("cursor","pointer").click(function(){n("#trace_label_difftimes");e("#trace_label_sametimes");e("#trace_label_profit");e("#trace_label_margin");if(a("#trace_type").val()!="difftimes"){a("#trace_type").val("difftimes");a.cleanTrace()}});a("#trace_label_profit").css("cursor","pointer").click(function(){n("#trace_label_profit");e("#trace_label_sametimes");e("#trace_label_difftimes");e("#trace_label_margin");if(a("#trace_type").val()!="profit"){a("#trace_type").val("profit");a.cleanTrace()}});a("#trace_label_margin").css("cursor","pointer").click(function(){n("#trace_label_margin");e("#trace_label_sametimes");e("#trace_label_difftimes");e("#trace_label_profit");if(a("#trace_type").val()!="margin"){a("#trace_type").val("margin");a.cleanTrace()}})};a.cleanTrace=function(){a.each(a.fn.lottery_periodArr,function(b,c){c.ischecked=false;c.times=0;c.money_buy=0;c.money_prize=0;c.money_profit=0;c.money_percent=0});a("input[name^='trace_issue']",a("#trace_detail")).each(function(b,c){a(c).parent().parent().find("input[name^='trace_times_']").attr("disabled",true).val(0);a(c).parent().parent().find("span[class^='trace_money']").each(function(d,e){a(this).html(0)});a(c).attr("checked",false);if(a(c).attr("checked")===true){opts.fun_unselect(a(c).parent().parent())}});a("#trace_label_sametimes_text").find("span").html(0);a("#trace_label_difftimes_text").find("span").html(0);a("#trace_label_profit_text").find("span").html(0);a("#trace_label_margin_text").find("span").html(0);a("#trace_totalamount").val(0)}})(jQuery);
