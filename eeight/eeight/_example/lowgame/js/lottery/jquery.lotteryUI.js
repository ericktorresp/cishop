(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert("requires jQuery v1.2.3 or later!  You are using v"+$.fn.jquery);return}var lottery_config={lottery:{1:"3D",2:"P5"},method:{9:"ZX",10:"ZXHZ",11:"TX",12:"ZS",13:"ZL",14:"HHZX",15:"ZUXHZ",16:"YMBDW",17:"EMBDW",18:"QEZX",19:"HEZX",20:"QEZUX",21:"HEZUX",22:"DWD",23:"DWD",24:"DWD",26:"QEDXDS",27:"HEDXDS",37:"ZX",38:"ZXHZ",39:"TX",40:"ZS",41:"ZL",42:"HHZX",43:"ZUXHZ",44:"YMBDW",45:"EMBDW",46:"QEZX",47:"HEZX",48:"QEZUX",49:"HEZUX",50:"DWD",51:"DWD",52:"DWD",53:"DWD",54:"DWD",55:"QEDXDS",56:"HEDXDS",57:"HEDXDS",58:"HEZX",59:"HEZUX"}};$.lotteryUI=function(opts){opts=$.extend({},$.lotteryUI.defaults,opts||{});$.fn.lottery_option={lotteryid:parseInt(opts.lottery,10),lottery:lottery_config.lottery[parseInt(opts.lottery,10)],method:lottery_config.method[parseInt(opts.methodtype,10)],period:opts.period,price:Number(opts.singleprice),prize:Number(opts.singleprize),money:Number(opts.usermoney),limitbons:parseInt(opts.limitbons,10),bigcancel:parseInt(opts.bigcancel,10),canclepre:Number(opts.canclepre),ajaxurl:opts.ajaxurl,confirmsplit:opts.confirmsplit};$.fn.lottery_no=[];$.fn.lottery_no_edit=[];$.fn.lottery_no_confirm=[];$.fn.lottery_periodArr=[];$.fn.lottery_no_count=0;$.fn.lottery_no_moneycount=0;$.fn.lottery_istrace=false;$.fn.lottery_submiting=false;$.fn.lottery_blocks={timer:opts.timer,nowIssue:opts.nowIssue,endTime:opts.endTimearea,isSelect:opts.selectArea,isfilter:opts.filterArea,iseditor:opts.editArea,isconfirm:opts.confirmArea,istrace:opts.traceArea};if(opts.timer!=null){$.lotteryTimer(opts.timer,opts.servertime,opts.endtime)}if(opts.nowIssue!=null){$(opts.nowIssue).html(opts.period)}if(opts.endTimearea!=null){$(opts.endTimearea).html(opts.endtime)}if(opts.selectArea!=null){$(opts.selectArea).loterrySelectArea(opts.selectDefault)}if(opts.filterArea!=null){$(opts.filterArea).loterryFilterArea(opts.filterDefault)}if(opts.editArea!=null){$(opts.editArea).loterryEditArea(opts.editDefault)}if(opts.confirmArea!=null){$(opts.confirmArea).loterryConfirmArea(opts.confirmDefault)}if(opts.traceArea!=null){$.fn.lottery_traceOptions=opts.traceDefault;$(opts.traceArea).loterryTraceArea(opts.traceDefault)}if(opts.submitbutton==null){$.alert(lottery_lang.data_error)}$(opts.submitbutton).click(function(){$.lottery_submit(this)})};$.lotteryUI.version="1.1.0";$.lotteryUI.defaults={lottery:1,methodtype:9,period:"2009001",singleprice:2,singleprize:1700,limitbons:0,bigcancel:0,canclepre:0,servertime:"",endtime:"",timer:null,nowIssue:null,endTimearea:null,usermoney:0,ajaxurl:"",selectArea:null,selectDefault:{type:"normal",tableCss:"lottery_selectarea_table",layout:[{title:"BW",no:"0|1|2|3|4|5|6|7|8|9",place:0,cols:1},{title:"SW",no:"0|1|2|3|4|5|6|7|8|9",place:1,cols:1},{title:"GW",no:"0|1|2|3|4|5|6|7|8|9",place:2,cols:1}],titleCss:"lottery_selectarea_title",noCss:"lottery_selectarea_num",noSelectCss:"lottery_selectarea_num_check",noBigIndex:5,isButton:true,buttonCss:"lottery_selectarea_button",test:""},filterArea:null,filterDefault:{css:"",show:"all",span:["0","1","2","3","4","5","6","7","8","9"],fixed:["0","1","2","3","4","5","6","7","8","9"]},editArea:null,editDefault:{tableCss:"lottery_editarea_table",textareaCss:"lottery_editor_textarea",button_random_Image:"",button_random_text:lottery_lang.button_random,button_random_CSS:"lottery_button_random",input_random_CSS:"",button_import_Image:"",button_import_text:lottery_lang.button_import,button_import_CSS:"lottery_button_import",button_clear_Image:"",button_clear_text:lottery_lang.button_clear,button_clear_CSS:"lottery_button_clear",button_insert_Image:"",button_insert_text:lottery_lang.button_insert,button_insert_CSS:"lottery_button_insert",button_delete_Image:"",button_delete_text:lottery_lang.button_delete,button_delete_CSS:"lottery_button_delete"},confirmArea:null,confirmsplit:" ",confirmDefault:{textareaCss:"lottery_confirm_textarea",jswordCss:"lottery_js_word",inputCss:"lottery_input lottery_input_underline"},traceArea:null,traceDefault:{periods:["2009001","2009002"],selectype:["sametimes","difftimes","profit","margin"],label_css:"lottery_tracearea_table_label",label_front_css:"lottery_td_front",label_back_css:"lottery_td_back",label_space_css:"lottery_td_space",label_line_css:"lottery_td_line",label_content_css:"lottery_label_div",table_css:"lottery_tracearea_table",input_css:"lottery_input lottery_input_underline",money_css:"lottery_tracearea_money",button_image:"",button_text:lottery_lang.button_trace,fun_select:function(){},fun_unselect:function(){},button_css:""},submitbutton:null};$.lotteryTimer=function(timer,starttime,endtime){if(starttime==""||endtime==""){$.fn.lottery_TimeCount=0}else{$.fn.lottery_TimeCount=(format(endtime).getTime()-format(starttime).getTime())/1000}function fftime(n){return Number(n)<10?""+0+Number(n):Number(n)}function format(dateStr){return new Date(dateStr.replace(/[\-\u4e00-\u9fa5]/g,"/"))}function diff(t){return t>0?{day:Math.floor(t/86400),hour:Math.floor(t%86400/3600),minute:Math.floor(t%3600/60),second:Math.floor(t%60)}:{day:0,hour:0,minute:0,second:0}}var timerno=window.setInterval(function(){if($.fn.lottery_TimeCount<=0){clearInterval(timerno);if($.fn.lottery_submiting==false){$.confirm({message:lottery_lang.msg_timeout,funyes:function(){$.lotteryRest(false)},funno:function(){$.lotteryRest(true)}})}}var oDate=diff($.fn.lottery_TimeCount--);$(timer).html(""+(oDate.day>0?oDate.day+(lottery_lang.time_day)+" ":"")+fftime(oDate.hour)+":"+fftime(oDate.minute)+":"+fftime(oDate.second))},1000)};$.lotteryRest=function(keep){if(keep&&keep===true){keep=true}else{keep=false}if($.fn.lottery_TimeCount<=0){$.ajax({type:"POST",URL:$.fn.lottery_option.ajaxurl,data:"lotteryid="+$.fn.lottery_option.lotteryid+"&flag=read",success:function(data){var partn=/<script.*>.*<\/script>/;if(partn.test(data)){alert(lottery_lang.msg_login);top.location.href="../?controller=default";return false}if(data=="empty"){alert(lottery_lang.msg_saletime);window.location.href="./?controller=default&action=start";return false}data=eval(data);$.fn.lottery_option.money=Math.floor(Number(data[0].userinfo.availablebalance)*100)/100;if($.fn.lottery_blocks.nowIssue!=null){$.fn.lottery_option.period=data[0].issue;$($.fn.lottery_blocks.nowIssue).html(data[0].issue);$("#lottery_currentissue").val(data[0].issue)}if($.fn.lottery_blocks.endTime!=null){$($.fn.lottery_blocks.endTime).html(data[0].saleend)}if($.fn.lottery_blocks.timer!=null){$.lotteryTimer($.fn.lottery_blocks.timer,data[0].nowtime,data[0].saleend)}if($.fn.lottery_blocks.isSelect!=null){if(keep==false){$("div[name^='lottery_no_']",$($.fn.lottery_blocks.isSelect)).attr("class",$.fn.lottery_noCss.unselect);$.each($.fn.lottery_no,function(i,n){$.each(n,function(j,m){if(typeof(m)=="number"){$.fn.lottery_no[i][j]=0}else{$.fn.lottery_no[i][j]={num:m.num,ischeck:0}}})})}}if($.fn.lottery_blocks.isfilter!=null){if(keep==false){$("#filter_span").attr("checked",false);$("#filter_span_select").attr("disabled",true);$("#filter_fixed").attr("checked",false);$("#filter_fixed_select").attr("disabled",true)}}if($.fn.lottery_blocks.iseditor!=null){if(keep==false){$.fn.lottery_no_edit=[];$("#lottery_editor").val("")}}if($.fn.lottery_blocks.isconfirm!=null){if(keep==false){$("#confirm_editor").val("");$("#lottery_total_order").html(0);$("#lottery_totalnum").val(0);$("#lottery_total_money").html(0);$("#lottery_totalamount").val(0);$("#lottery_times").val(1);$.fn.lottery_no_confirm=[];$("#lottery_confirmnums").val("");$.fn.lottery_no_count=0;$.fn.lottery_no_moneycount=0}}if($.fn.lottery_blocks.istrace!=null){var temparr=[];$.each(data[0].taskinfo,function(i,n){temparr.push("'"+n.issue+"'")});$.fn.lottery_traceOptions.periods=eval("["+temparr.join(",")+"]");$($.fn.lottery_blocks.istrace).empty().loterryTraceArea($.fn.lottery_traceOptions)}},error:function(){$.alert(lottery_lang.msg_ajaxerror);return false}})}else{if($.fn.lottery_blocks.isSelect!=null){if(keep==false){$("div[name^='lottery_no_']",$($.fn.lottery_blocks.isSelect)).attr("class",$.fn.lottery_noCss.unselect);$.each($.fn.lottery_no,function(i,n){$.each(n,function(j,m){if(typeof(m)!="object"){$.fn.lottery_no[i][j]=0}else{$.fn.lottery_no[i][j]={num:m.num,ischeck:0}}})})}}if($.fn.lottery_blocks.isfilter!=null){if(keep==false){$("#filter_span").attr("checked",false);$("#filter_span_select").attr("disabled",true);$("#filter_fixed").attr("checked",false);$("#filter_fixed_select").attr("disabled",true)}}if($.fn.lottery_blocks.iseditor!=null){if(keep==false){$.fn.lottery_no_edit=[];$("#lottery_editor").val("")}}if($.fn.lottery_blocks.isconfirm!=null){if(keep==false){$("#confirm_editor").val("");$("#lottery_total_order").html(0);$("#lottery_totalnum").val(0);$("#lottery_total_money").html(0);$("#lottery_totalamount").val(0);$("#lottery_times").val(1);$.fn.lottery_no_confirm=[];$("#lottery_confirmnums").val("");$.fn.lottery_no_count=0;$.fn.lottery_no_moneycount=0;$("#lottery_adjustcodes").val("");$("#lottery_adjustchoice").val(2)}}if($.fn.lottery_blocks.istrace!=null){$("#trace_check").attr("checked",false);$("#trace_stop").attr("disabled",true).attr("checked",false);$("#trace_content_area").hide();$("#lottery_istrace").val(0);$.cleanTrace()}}};$.lottery_submit=function(obj){function checkTimeOut(){if($.fn.lottery_TimeCount<=0){$.confirm({message:lottery_lang.msg_timeout,funyes:function(){$.lotteryRest(false)},funno:function(){$.lotteryRest(true)}});return false}else{return true}}if(checkTimeOut()==false){return false}$.fn.lottery_submiting=true;var confirmmsg="";var sign=0;var tmptotalmoney=0;if($("#lottery_currentissue").val()!=$.fn.lottery_option.period){$.fn.lottery_submiting=false;$.alert(lottery_lang.data_error);return false}if($("#confirm_editor").val()==""||$("#lottery_confirmnums").val()==""||Number($("#lottery_totalnum").val())<=0){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t1);return false}if(Number($("#lottery_totalnum").val())>1000){$.alert(lottery_lang.msg_sub_t2)}if(Number($("#lottery_istrace").val())==0){if(Number($("#lottery_totalamount").val())<=0||Number($("#lottery_times").val())<=0){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t3);return false}if(Number($("#lottery_totalamount").val())>$.fn.lottery_option.money){$.alert(lottery_lang.msg_sub_t4+$.fn.lottery_option.money);return false}if(($.fn.lottery_option.prize*Number($("#lottery_times").val()))>$.fn.lottery_option.limitbons){$.alert(lottery_lang.msg_sub_t5);return false}tmptotalmoney=Number($("#lottery_totalamount").val());confirmmsg+=lottery_lang.msg_sub_t6.replace("[issue]",$("#lottery_currentissue").val()).replace("[codes]",$("#confirm_editor").val()).replace("[money]",$("#lottery_totalamount").val());if(Number($("#lottery_totalamount").val())>=$.fn.lottery_option.bigcancel){confirmmsg+=lottery_lang.msg_sub_t7.replace("[money]",Math.floor((Number($("#lottery_totalamount").val())*$.fn.lottery_option.canclepre)*100)/100);sign=1;confirmmsg+="#"+sign}}else{tracecount=0;errorIssue="";outIssue="";var totalMoney=0;var charge=new Array();var tempCharge="";var m=0;$("input[name^='trace_issue']",$("#trace_detail")).each(function(i,n){if($(n).attr("checked")==true){totalMoney=Number($("input[name='trace_times_"+$(n).val()+"']").val())*Number($("#lottery_totalnum").val())*2;if(totalMoney>=$.fn.lottery_option.bigcancel){charge[m]=new Array();charge[m]["issue"]=$(n).val();charge[m]["charge"]=Math.floor((totalMoney*$.fn.lottery_option.canclepre)*100)/100;m++}tracecount++;if(Number($("input[name='trace_times_"+$(n).val()+"']").val())<=0){errorIssue+=$(n).val()+" "}if(($.fn.lottery_option.prize*Number($("input[name='trace_times_"+$(n).val()+"']").val()))>$.fn.lottery_option.limitbons){outIssue+=$(n).val()+" "}}});if(tracecount==0){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t8);return false}if(errorIssue!=""){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t9.replace("[errorIssue]",errorIssue));return false}if(outIssue!=""){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t10.replace("[outIssue]",outIssue));return false}if(Number($("#trace_totalamount").val())<=0){$.fn.lottery_submiting=false;$.alert(lottery_lang.msg_sub_t11);return false}if(Number($("#trace_totalamount").val())>$.fn.lottery_option.money){$.alert(lottery_lang.msg_sub_t4+$.fn.lottery_option.money);return false}tmptotalmoney=Number($("#trace_totalamount").val());confirmmsg+=lottery_lang.msg_sub_t12.replace("[tracecount]",tracecount).replace("[codes]",$("#confirm_editor").val()).replace("[money]",$("#trace_totalamount").val());if(charge.length>0){tempCharge="<br /><font color='red'>\u656c\u8bf7\u6ce8\u610f\uff1a\u5982\u64a4\u5355\u5c06\u6536\u53d6\u624b\u7eed\u8d39:</font><div style='height:60px;margin:5px;padding:5px;overflow:hidden;overflow-y:auto;'>";tempCharge+="<table width='100%'><tr><td width='50%' align='center'><font color='red'>\u5956\u671f</font></td><td width='50%' align='center'><font color='red'>\u64a4\u5355\u624b\u7eed\u8d39</font></td></tr>";for(var j=0;j<charge.length;j++){tempCharge+="<tr><td width='50%' align='center'><font color='blue'>"+charge[j]["issue"]+"</font></td><td width='50%' align='center'><font color='blue'>"+charge[j]["charge"]+"\u5143</font></td></tr>"}tempCharge+="</table></div>";confirmmsg+=lottery_lang.msg_sub_t13.replace("[charge]",tempCharge)}if(charge.length>0){sign=1}confirmmsg+="#"+sign}$.confirm({message:confirmmsg,funyes:function(){ajaxSubmit(obj)},funno:function(){$.fn.lottery_submiting=false;return checkTimeOut()}});function ajaxSubmit(obj){$.blockUI({message:lottery_lang.msg_ajax,overlayCSS:{backgroundColor:"#000000",opacity:0.5,cursor:"wait"}});var form=$(obj).closest("form");$.ajax({type:"POST",url:$.fn.lottery_option.ajaxurl,timeout:30000,data:$(form).serialize(),success:function(data){$.fn.lottery_submiting=false;var partn=/<script.*>.*<\/script>/;if(partn.test(data)){alert(lottery_lang.msg_login);top.location.href="../?controller=default";return false}else{if(data=="success"){$.alert({title:lottery_lang.msg_adjust_t,message:lottery_lang.msg_success,onclose:function(){if(checkTimeOut()==true){$.fn.lottery_option.money-=tmptotalmoney;$.lotteryRest();return false}}});return false}else{eval("data = "+data+";");if(data.stats=="error"){$.alert({message:data.data,onclose:function(){if(checkTimeOut()==true){$("#lottery_adjustcodes").val("");$("#lottery_adjustchoice").val(2);return false}}})}else{if(data.stats=="adjust"){$("#lottery_adjustcodes").val(data.data.serialdata);adjustConfirm(obj,data.data.codedata)}}return false}}},error:function(){$.fn.lottery_submiting=false;$.alert({message:lottery_lang.msg_ajax_t,onclose:checkTimeOut})}})}function adjustConfirm(obj,codedata){html='<div id="adjust_content" class="lottery_adjust_confirm"><div class="adjusttitlebox" id="adjust_title"><span class="adjusttitle">'+lottery_lang.msg_adjust_t+"</span></div>";html+='<div class="adjustmsg">'+lottery_lang.msg_adjust_t1+"</div>";html+='<div class="adjustcodebox"><div><table width="'+($.browser.msie?"93%":"100%")+'" border="1" cellpadding="3" cellspacing="0"><tr><th>'+lottery_lang.msg_adjust_t2+"</th><th>"+lottery_lang.msg_adjust_t3+"</th></tr>";$.each(codedata,function(i,n){html+='<tr><td align="center">'+i+'</td><td align="center">'+n+"</td></tr>"});html+='</table></div></div><div style="width:100%;margin-top:10px;"><ul><li><label for="adjust_choice_1"><input type="radio" name="adjust_choice" id="adjust_choice_1" value="1" checked> '+lottery_lang.msg_adjust_t4+'</label></li><li><label for="adjust_choice_2"><input type="radio" name="adjust_choice" id="adjust_choice_2" value="2"> '+lottery_lang.msg_adjust_t5+'</label></li><li><label for="adjust_choice_0"><input type="radio" name="adjust_choice" id="adjust_choice_0" value="0"> '+lottery_lang.msg_adjust_t6+'</label></li></ul></div><div class="confirmbuttonbox"><input type="button" name="adjust_submit" id="adjust_submit" value="'+lottery_lang.msg_adjust_t7+'"></div></div>';$html=$(html);$.blockUI({message:$html,css:{width:"600px",height:"350px",border:"1px #f9d3cb solid",backgroundColor:"#fdeedb"},overlayCSS:{backgroundColor:"#FFFFFF",opacity:0.6,cursor:"default"},centerX:true,centerY:true,onUnblock:function(){$("#lottery_adjustcodes").val("");$("#lottery_adjustchoice").val(2)}});fullCenter($(".blockMsg"));$("#adjust_submit",$html).click(function(){if($("#adjust_choice_0",$html).attr("checked")==true){if(checkTimeOut()==true){$.unblockUI({fadeOut:0});$.lotteryRest();return false}}else{if($("#adjust_choice_1",$html).attr("checked")==true){$("#lottery_adjustchoice").val(1)}else{$("#lottery_adjustchoice").val(2)}}ajaxSubmit(obj);return false})}function fullCenter(el){var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent);var topset=$(window).height()/2-$(el).height()/2+(ie6?document.documentElement.scrollTop:0);var leftset=$(window).width()/2-$(el).width()/2+(ie6?document.documentElement.scrollLeft:0);$(el).css({left:leftset+"px",top:topset+"px"})}}})(jQuery);
