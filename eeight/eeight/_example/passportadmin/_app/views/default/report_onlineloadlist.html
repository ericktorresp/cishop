{include file="pageheader.html"}
<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript" src="./js/calendar/jquery.dyndatetime.js"></script>
<script type="text/javascript" src="./js/calendar/lang/calendar-utf8.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="./js/calendar/css/calendar-blue2.css"  />
{literal}
<script type="text/javascript">
//复制内容到剪贴板
function copyToClipboard(obj)
{
	txt = jQuery("#"+obj).html();
	if(window.clipboardData) 
	{
		window.clipboardData.clearData();
		window.clipboardData.setData("Text", txt);
	}
	else if(navigator.userAgent.indexOf("Opera") != -1) 
	{
		window.location = txt;
	} 
	else if (window.netscape) 
	{
		try 
		{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		} 
		catch (e) 
		{
			alert("您的firefox安全限制限制您进行剪贴板操作，请在地址栏中输入“about:config”将“signed.applets.codebase_principal_support”设置为“true”之后重试");
			return false;
		}
		var clip = Components.classes['@mozilla.org/widget/clipboard;1'].createInstance(Components.interfaces.nsIClipboard);
		if (!clip)
		return;
		var trans = Components.classes['@mozilla.org/widget/transferable;1'].createInstance(Components.interfaces.nsITransferable);
		if (!trans)
		return;
		trans.addDataFlavor('text/unicode');
		var str = new Object();
		var len = new Object();
		var str = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
		var copytext = txt;
		str.data = copytext;
		trans.setTransferData("text/unicode",str,copytext.length*2);
		var clipid = Components.interfaces.nsIClipboard;
		if (!clip)
		return false;
		clip.setData(trans,null,clipid.kGlobalClipboard);
	}else{
		alert("你的浏览器暂时不支持此功能，建议使用Firefox");
		return false;
	}
	alert('复制成功!');
}

	jQuery(document).ready(function() {
		jQuery("#sdate").dynDateTime({
			ifFormat: "%Y-%m-%d %H:%M",
			daFormat: "%l;%M %p, %e %m,  %Y",
			align: "Br",
			electric: true,
			singleClick: false,
			button: ".next()", //next sibling
			showOthers: true,
			weekNumbers: true,
			//onUpdate: function(){alert('1');}
			showsTime: true
		});
		jQuery("#sdate").change(function(){
			if(! validateInputDate(jQuery("#sdate").val()) )
			{jQuery("#sdate").val('');alert("时间格式不正确,正确的格式为:2009-06-10 10:59");}
		});
		jQuery("#edate").dynDateTime({
			ifFormat: "%Y-%m-%d %H:%M",
			daFormat: "%l;%M %p, %e %m,  %Y",
			align: "Br",
			electric: true,
			singleClick: false,
			button: ".next()", //next sibling
			showOthers: true,
			weekNumbers: true,
			//onUpdate: function(){alert('1');}
			showsTime: true
		});
		jQuery("#edate").change(function(){
			if(! validateInputDate(jQuery("#edate").val()) )
			{jQuery("#edate").val('');alert("时间格式不正确,正确的格式为:2009-06-10 10:59");}
		});
		jQuery("#sdate2").dynDateTime({
			ifFormat: "%Y-%m-%d %H:%M",
			daFormat: "%l;%M %p, %e %m,  %Y",
			align: "Br",
			electric: true,
			singleClick: false,
			button: ".next()", //next sibling
			showOthers: true,
			weekNumbers: true,
			//onUpdate: function(){alert('1');}
			showsTime: true
		});
		jQuery("#sdate2").change(function(){
			if(! validateInputDate(jQuery("#sdate2").val()) )
			{jQuery("#sdate2").val('');alert("时间格式不正确,正确的格式为:2009-06-10 10:59");}
		});
		jQuery("#edate2").dynDateTime({
			ifFormat: "%Y-%m-%d %H:%M",
			daFormat: "%l;%M %p, %e %m,  %Y",
			align: "Br",
			electric: true,
			singleClick: false,
			button: ".next()", //next sibling
			showOthers: true,
			weekNumbers: true,
			//onUpdate: function(){alert('1');}
			showsTime: true
		});
		jQuery("#edate2").change(function(){
			if(! validateInputDate(jQuery("#edate2").val()) )
			{jQuery("#edate2").val('');alert("时间格式不正确,正确的格式为:2009-06-10 10:59");}
		});
	});

		//add 3/19/2010
	$(document).ready(function(){
		checkstatus = function(id){
			alert('本项功能未经测试,禁用中...');
			return false;
	
			$("#onlineload" + id).html("<i>Processing</i>");
			var operateHtml = "";
			//normalopen = document.getElementById('normalopen').checked;
			//if (normalopen == TRUE){
			//	window.locatioon = '?controller=report&action=onlineloadtoquery&id='+id+'&stype=htm';
			//}
			$.ajax({
				type:"GET",
				url:'?controller=report&action=onlineloadtoquery',
				data:'id=' + id,
				success:function(data){
					showback = document.getElementById('showbackinfo').checked;
					if (data == 888){
						sStr = "充值完成！";
					} else if(data == 100){
						sStr = "支付单继续挂起，请稍候重试！";
					} else if(data == 101){
						sStr = "支付单废止，无须再次操作！";
					} else if(data == 102){
						sStr = "充值失败！稍候重试。";
					} else if(data == 103){
						sStr = "客户资金帐户因其他操作锁定中。请稍后重试！";
					} else if(data == 104){
						sStr = "提交数据错误。刷新页面重试！";
					}else{
						sStr = "unKnow Error";
					}
					if (showback != TRUE){
						alert(sStr);
					}
					operateHtml = displaybutton(id,data);
					$("#onlineload" + id).html(operateHtml);
				}
			});
		}
		
		function displaybutton(id,num){
			var tempHtml = "";
			if (num == 888){
				tempHtml = "<font color=green>完成</font>";
			} else if(num == 101){
				tempHtml = "<font color=red>失败单</font>";
			} else {
				tempHtml = "<span style='cursor:pointer;text-decoration:underline;'' onclick='checkstatus("+id+");'>再拾</span>";
			}
			return tempHtml;
		}

	});		
	


</script>
{/literal}

<div class="form-div">
    <FORM name="searchForm" action="" METHOD='get'>
    <input type='hidden' name="controller" value="report"/>
    <input type='hidden' name="action" value="onlineloadlist"/>
    <img src="./images/icon_search.gif" width="26" height="22" border="0" TITLE="SEARCH" />
状态: <select name="status">
<option value="-1" {if $s.status=='-1'}SELECTED{/if}>全部</option>
<option value="0" {if $s.status=='0'}SELECTED{/if}>支付中</option>
<option value="1" {if $s.status=='1'}SELECTED{/if}>充值成功</option>
<option value="2" {if $s.status=='2'}SELECTED{/if}>失败单</option>
<option value="3" {if $s.status=='3'}SELECTED{/if}>挂起单</option>
</select> &nbsp;&nbsp;&nbsp;&nbsp;



<div style='padding: 5px 20px 2px 29px;'>
<font color='red'>充值操作</font>时间 起始于: <input type="text" id="sdate" name="sdate" size='17' value='{$s.sdate|escape:html}' /> <img src="./images/calendar2.gif"> &nbsp; 至 &nbsp; 
<input type="text"id="edate" name="edate"  size='17' value='{$s.edate|escape:html}' /> <img src="./images/calendar2.gif" />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<!-- 处理管理员: < input type="text" name="losttodo" size='15' value='{$s.losttodo|escape:html}' / > -->
<br/>

<font color='blue'>支付平台处理</font>时间 起始于: <input type="text" id="sdate2" name="sdate2" size='17' value='{$s.sdate2|escape:html}' /> <img src="./images/calendar2.gif"> &nbsp; 至 &nbsp; 
<input type="text"id="edate2" name="edate2"  size='17' value='{$s.edate2|escape:html}' /> <img src="./images/calendar2.gif" />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
充值用户 : <input type="text" name="username" size='15' value='{$s.username|escape:html}' />
<br>
充值方式: <select name="loadtype">
<option value="">所有</option>
{foreach from=$paylist item=pay key=pi}
<option value="{$pi}" {if $s.loadtype == $pi}SELECTED{/if}>{$pay}</option>
{/foreach}
</select>
币种: <select name="loadcurrency">
<option value="">不限</option>
{foreach from=$paycurr item=curr}
<option value="{$curr}" {if $s.loadcurrency == $curr}SELECTED{/if}>{$curr}</option>
{/foreach}
</select>

&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" value="搜 索" class="button" /> <a href="javascript:showNotice('noticeSearch');" title="帮助信息"><img src="./images/notice.gif" width="16" height="16" border="0" title="帮助信息"></a>
<span class="notice-span" style='line-height:18px;padding:8px 0px 2px 20px;color:#669900' 
id="noticeSearch">

用户名必须严格匹配, 例: <b><font color=red>Froger</font></b> 可使用ID查询 <br>
状态：	<br> 
&nbsp; &nbsp; <b>支付中</b> 意为:客户正在充值操作中，平台还未得到支付接口任何返回信息。<br>
&nbsp; &nbsp; <b>充值成功</b> 意为:整个充值过程顺利完成,用户平台资金已增加。<br>
&nbsp; &nbsp; <b>失败单</b> 意为:因第三方原因不能完成的充值单。例如：银行拒绝、平台拒绝<br>
&nbsp; &nbsp; <b>挂起单</b> 意为:需人工继续干预的充值单。例如：交易处理延迟、网络掉包<br>
</span>
</div>
  </FORM>
</div>
<div class="list-div" id="listDiv">

<form method="POST" name="listForm" action='./?controller=report&action=onlineloadlist' onsubmit="return confirmSubmit(this)">
<table cellspacing='1' cellpadding='3' id='list-table'>
  <tr>
    <th rowspan=2>交易号</th>
    <th rowspan=2>字串ID</th>
	<th rowspan=2>状态</th>
    <th rowspan=2>用户</th>
    <th rowspan=2>金额</th>
    <th rowspan=2>币种</th>
    <th rowspan=2>充值操作时间</th>
    <th colspan=2>支付接口处理</th>
    <th rowspan=2>拾单记录</th>
    <th rowspan=2>分账户</th>
    <th rowspan=2>操作</th>
  </tr>
<tr>
<th>时间</th>
<th>结果</th>
</tr>
{foreach from=$Loadlist item=list key=k1}
  <tr>
    <td align="left">L{$list.id}</td>
    <td align="left">{$list.spec_name}</td>
	<td align="center">
	{if $list.load_status== 1}
		成功
	{elseif $list.load_status== 0}
		支付中
	{elseif $list.load_status== 2}
		废单
	{else}
		挂起
	{/if}
	</td>
	<td align="left">{$list.user_name|escape:html}</td>
	<td align="right">{$list.load_amount|escape:money}</td>
	<td align="center">{$list.load_currency|escape:html}</td>
	<td align="center">{$list.trans_time|escape:html}</td>
	<td align="center">{if $list.reback_time != 0}{$list.reback_time|escape:html}{/if}</td>
	<td align="left">{$list.reback_note|escape:html}</td>
	<td align="center">{if $list.lost_todo_time != 0}{$list.lost_todo}{$list.lost_todo_time}{/if}</td>
	<td align="left">{$list.acc_name}</td>
	<td align="center" id="onlineload{$list.id}" width="80">
	{if $list.payport_attr_ques != 0 }
	{if $list.load_status != 1}<span style='cursor:pointer;text-decoration:underline;'' onclick='checkstatus({$list.id});'>拾单</span>{else} -- {/if}
	{/if}
	</td>
  </tr>
{foreachelse}
    <tr><td class="no-records" colspan="12">无相关数据</td></tr>
{/foreach}
  <tr>
    <td colspan="2"></td>
    <td align="right" noWrap="true" colspan="10">&nbsp;<!-- input type="checkbox" value="yes" name="showbackinfo" id="showbackinfo"><label for="showbackinfo">不显示查询返回的弹出提示</label --> &nbsp; &nbsp; <!--  input type="checkbox" value="yes" name="normalopen" id="normalopen" >< label for="normalopen" >使用页面跳转方式执行< / label --></td>
  </tr>
</table>

<table id="page-table" cellspacing="0"><tr><td align="right" nowrap="true">
<div style='padding-right:30px; padding-top:6px;'>{$pages}</div></td></tr></table>
<input type='hidden' name="p" value="{$s.p}"/>
<input type='hidden' name="pn" value="{$s.pn}"/>
</form>
</div>


{literal}
<script language="JavaScript">
function showNotice(objId)
{
    var obj = document.getElementById(objId);

    if (obj)
    {
        if (obj.style.display != "block")
        {
            obj.style.display = "block";
        }
        else
        {
            obj.style.display = "none";
        }
    }
}
if (document.getElementById("listDiv"))
{
  document.getElementById("listDiv").onmouseover = function(e)
  {
    obj = Utils.srcElement(e);

    if (obj)
    {
      if (obj.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode;
      else if (obj.parentNode.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode.parentNode;
      else return;

      for (i = 0; i < row.cells.length; i++)
      {
        if (row.cells[i].tagName != "TH") row.cells[i].style.backgroundColor = '#EEF8F9';
      }
    }

  }

  document.getElementById("listDiv").onmouseout = function(e)
  {
    obj = Utils.srcElement(e);

    if (obj)
    {
      if (obj.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode;
      else if (obj.parentNode.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode.parentNode;
      else return;

      for (i = 0; i < row.cells.length; i++)
      {
          if (row.cells[i].tagName != "TH") row.cells[i].style.backgroundColor = '#FFF';
      }
    }
  }
}
</script>
{/literal}
{include file="pagefooter.html"}