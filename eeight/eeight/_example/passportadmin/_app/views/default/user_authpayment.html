{include file="pageheader.html"}
<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript" src="./js/jquery.impromptu.2.6.min.js"></script>
<LINK href="./css/impromptu.css" rel="stylesheet" type="text/css" />
{literal}
<script type="text/javascript">
function CheckBoxSelectAll(obj, chk)
{
  if (chk == null)
  {
    chk = 'checkboxes';
  }

  var elems = obj.form.getElementsByTagName("INPUT");

  for (var i=0; i < elems.length; i++)
  {
    if (elems[i].name == chk || elems[i].name == chk + "[]")
    {
      elems[i].checked = obj.checked;
    }
  }
}

function numchange(obj,TYPE,str)
{
		var elems = obj.form.getElementsByTagName(TYPE);
		for (var i=0; i < elems.length; i++)
	  	{
			var names= elems[i].name;
			
			if(names.substr(0,str.length) == str)
	    	{
		    	if(TYPE=="INPUT")
		    	{
	      			//elems[i].value = obj.value;
	      			if (document.getElementById('all_allow').checked == true){
	      				elems[i].checked = true;
	      			}else{
	      				elems[i].checked = false;
	      			}
		    	}
		    	else if(TYPE=="SELECT")
		    	{
			    	elems[i].options[obj.selectedIndex].selected = "TRUE" ;
				}
	    	}
	  	}
}

function checksss()
{
	ss ="";
	var elems = document.getElementsByTagName("INPUT");
	for (var i=0; i < elems.length; i++)
	{
		if (elems[i].name =="userid" || elems[i].name == "userid[]")
	    {
		    
	    	if(elems[i].checked)
	      	{
		      	id= elems[i].value;
		      	agents = document.getElementById("agent_"+id).innerHTML;
		      	auths = document.getElementById("payment_level_"+id);
		      	payment_level = auths.options[auths.selectedIndex].innerHTML;
		      	
			    if (document.getElementById("allow_"+id).checked){
				    allow = '允许';
			    }else{
				    allow = '禁止';
			    }
		      	s = "<tr><td>"+agents+"</td><td>"+payment_level+"</td><td>"+allow+"</td></tr>";
		      	ss = ss+s;
		   	}
	    }
	}
	/*if(ss =="")
	{
		alert('请勾选希望更新的数据行');
		return false;
	}
	else
	{*/
		ss="<div style='overflow-y: auto; height: 200px; width: 100%;'><table class='list-div'><tr><th>总代</th><th>授权级别</th><th>是否许可</th></tr>"+ss+"</table></div>";
		$.prompt(ss,{ buttons: { "确认": true, "取消": false }, show:'slideDown' ,callback:mycallbackform,focus: 1 });
	//}
}

function mycallbackform(v,m,f){
	if(v){
		document.forms['list-form'].submit();
	}
}

{/literal}
</script>

<div class="form-div">
	<FORM METHOD="GET" ACTION="">
	<input type="hidden" name="controller" value="user">
	<input type="hidden" name="action" value="authpayment">
	<img src="./images/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
	查看已设定 开放至级别：<select name="payment_level">
	<option value="-2" {if $payment_level==-2}selected="selected"{/if}>(不限)</option>
	<option value="0" {if $payment_level==0}selected="selected"{/if}>总代级别</option>
	<option value="1" {if $payment_level==1}selected="selected"{/if}>一级代理</option>
	<option value="2" {if $payment_level==2}selected="selected"{/if}>二级代理</option>
	<option value="3" {if $payment_level==3}selected="selected"{/if}>三级代理</option>
	<option value="4" {if $payment_level==4}selected="selected"{/if}>四级代理</option>
	<option value="5" {if $payment_level==5}selected="selected"{/if}>五级代理</option>
	<option value="6" {if $payment_level==6}selected="selected"{/if}>六级代理</option>
	<option value="7" {if $payment_level==7}selected="selected"{/if}>七级代理</option>
	<option value="8" {if $payment_level==8}selected="selected"{/if}>八级代理</option>
	<option value="9" {if $payment_level==9}selected="selected"{/if}>九级代理</option>
	<option value="10" {if $payment_level==10}selected="selected"{/if}>十级代理</option>
	</select>&nbsp;&nbsp; 在线充提权限:
	<select name="topset">
	<option value="0">(不限)</option>
	<option value="2" {if $topset==2}selected="selected"{/if}>许可的</option>
	<option value="1" {if $topset==1}selected="selected"{/if}>禁止的</option>
	</select>&nbsp;&nbsp;&nbsp;&nbsp;
	<input type="submit" value="搜索" class="button"><a href="javascript:showNotice('noticesearch');"><img src="./images/notice.gif" border="0" title="搜索"></a> <span id="noticesearch" style="display:none;">搜索内容不指定最高开户权限和总代限制时候，默认为所有总代用户。</span>
	</FORM>
</div>
<div class="list-div">
<form method="POST" action="?controller=user&action=saveauthpayment" name="list-form" id="list-form">
<table id='list-table'>
<tr>
	<th width="15">&nbsp;</th>
	<th>总代名</th>
	<th>开放至(代理级别)</th>
	<th>是否许可</th>
</tr>
{foreach from=$users item=user key=v}
<tr>
	<td align="center"><label for="userid_{$user.userid}"><input type="checkbox" id="userid_{$user.userid}" name="userid[]" value="{$user.userid}"></label></td>
	<td class="narrow-label" id="agent_{$user.userid}"><span style="cursor:pointer">{$user.username|escape:html}</span></td>
	<td align="center"><select name="payment_level[{$user.userid}]" id="payment_level_{$user.userid}">
	<option value="0" {if $user.payment_level==0}selected="selected"{/if}>总代级别</option>
	<option value="1" {if $user.payment_level==1}selected="selected"{/if}>一级代理</option>
	<option value="2" {if $user.payment_level==2}selected="selected"{/if}>二级代理</option>
	<option value="3" {if $user.payment_level==3}selected="selected"{/if}>三级代理</option>
	<option value="4" {if $user.payment_level==4}selected="selected"{/if}>四级代理</option>
	<option value="5" {if $user.payment_level==5}selected="selected"{/if}>五级代理</option>
	<option value="6" {if $user.payment_level==6}selected="selected"{/if}>六级代理</option>
	<option value="7" {if $user.payment_level==7}selected="selected"{/if}>七级代理</option>
	<option value="8" {if $user.payment_level==8}selected="selected"{/if}>八级代理</option>
	<option value="9" {if $user.payment_level==9}selected="selected"{/if}>九级代理</option>
	<option value="10" {if $user.payment_level==10}selected="selected"{/if}>十级代理</option>
	</select></td>
	<td align="center">
	<label for="allow_{$user.userid}"><input type="checkbox" name="allow[{$user.userid}]" value="1" id="allow_{$user.userid}" {if $user.can_payment==1}Checked{/if}>
	{if $user.can_payment==1}<font color=blue>保持许可</font>{else}<font color=green>勾选允许</font>{/if}</label>
	</td>

</tr>
{foreachelse}
<tr>
<td colspan="8" class="no-records">没有找到符合条件的相关总代</td>
</tr>
{/foreach}
<tr>
	<th align="center"><input type="checkbox" onclick="javascript:CheckBoxSelectAll(this,'userid');">保存全部</th>
	<th class="narrow-label"> 统一修改:</th>
	<th align="center"><select onchange="javascript:numchange(this,'SELECT','payment_level');">
	<option value="0">总代级别</option>
	<option value="1">一级代理</option>
	<option value="2">二级代理</option>
	<option value="3">三级代理</option>
	<option value="4">四级代理</option>
	<option value="5">五级代理</option>
	<option value="6">六级代理</option>
	<option value="7">七级代理</option>
	<option value="8">八级代理</option>
	<option value="9">九级代理</option>
	<option value="10">十级代理</option>
	</select></th>
	<th align="center">
	<input type="checkbox" id="all_allow" onclick="javascript:numchange(this,'INPUT','allow');">全部许可</th>
</tr>
<tr>
<td></td>
<td colspan="7"><input class="button" type="button" value="保存" onclick="javascript:return checksss();"><input class="button" type="reset" value="还原"><a href="javascript:showNotice('noticesubmit');"><img src="./images/notice.gif" border="0" title="搜索"></a></td>
</tr>
</table>
</form>
</div>
<script>
function ClickBox(u){
	
}
</script>
{include file="pagefooter.html"}