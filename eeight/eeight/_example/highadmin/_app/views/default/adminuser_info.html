{include file="pageheader.html"}
<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript">
jQuery.noConflict();
function check_top(thisid,topid)
{
	//alert(jQuery("#"+thisid).attr("checked"));
	if( jQuery("#"+thisid).attr("checked") == true )
	{
		jQuery("#"+topid).attr("checked",true);
	}
}
function clear_son( topid )
{
	if( jQuery("#"+topid).attr("checked") == false )
	{
		jQuery("#"+topid).parent().parent().nextAll().find(":checkbox").attr("checked",false);
	}
}
function clear_bytop( topid, count )
{
	if( jQuery("#"+topid).attr("checked") == false )
	{
		jQuery("#"+topid).closest("tr").find(":checkbox").attr("checked",false);
		for(i=0;i<count-1;i++)
		{
			jQuery("#"+topid).closest("tr").nextAll("tr:eq("+i+")").find(":checkbox").attr("checked",false);
		}
		//jQuery("#"+topid).closest("tr").nextAll().find("td").not(".first-cell").find(":checkbox").attr("checked",false);
	}
}
</script>
<div class="list-div" id="listDiv">
<form method="POST" name="listForm" action="./?controller=adminuser&action=update" onsubmit="return validate()">
  
  <div class="tab-div">
  <div id="tabbar-div"><span 
	class="tab-front" id="general-tab">基本信息编辑</span><span 
	 class="tab-back" id="detail-tab">用户特殊权限</span>
  </div>
  
  <table cellspacing='1' cellpadding='3' id="general-table">  
    <tr>
      <td width="150" align="right">所属组别:</td>
      <td><select name="groupid" id="groupid">
      {$aAdminGroup}
      </select></td>
    </tr>
    <tr>
      <td width="150" align="right">管理员登陆账号</td>
      <td><input type="text" name="adminuser" id="adminuser" value="{$user.adminname|escape:html}"></td>
    </tr>
    <tr>
      <td width="150" align="right">管理员密登陆码:</td>
      <td><input type="password" name="adminpass" id="adminpass"> ( 不希望改变用户密码,留空即可 )</td>
    </tr>
    <tr>
      <td width="150" align="right">确认密码:</td>
      <td><input type="password" name="adminpass2" id="adminpass2"> ( 6－16 位数字和字母，不能只是数字，或者只是字母，不能连续三位相同 )</td>
    </tr>
    <tr>
      <td width="150" align="right">管理员昵称:</td>
      <td><input type="text" name="adminnick" id="adminnick" value="{$user.adminnick|escape:html}"></td>
    </tr>
    <tr>
      <td width="150" align="right">系统语言:</td>
      <td><select name="adminlang" id="adminlang">
      <option value='utf8_zhcn' {if $user.adminlang=="utf8_zhcn"}selected="selected"{/if}>简体中文</option> 
      <option value='utf8_enus' {if $user.adminlang=="utf8_enus"}selected="selected"{/if}>English(美国)</option>
      </select></td>
    </tr>
	    <tr>
      <td width="150" align="right">账户状态:</td>
      <td><select name="islocked" id="adminlang">
	  <option value="0" {if $user.islocked==1}selected="selected"{/if}>正常</option>
      <option style='color:#FF6633' value="1" {if $user.islocked!=0}selected="selected"{/if}>锁定禁用</option> 
      </select></td>
    </tr>
  </table>
  
<table cellspacing='1' cellpadding='2' id="detail-table" style="display:none">
<tr>{foreach from=$menus.0 item=menu key=top}
	<td rowspan="{$counts.$top}"  class="first-cell" style='width:16%;'><label for="menu_{$top}" TITLE='{$menu.desc}'><input type="checkbox" 
	name="menustrs[]" id="menu_{$top}" value="{$top}" {if $menu.check||$usermenus.$top}checked="checked"{/if} 
	{if $menu.check}disabled{/if}
	onclick="clear_bytop('menu_{$top}',{$counts.$top})">{$menu.title}</label></td>
	{foreach from=$menus.$top item=menu2 key=top2}
		<td width="15%" style='color:#690;padding-left:6px;'><label for="menu_{$top2}" TITLE='{$menu2.desc}'><input type="checkbox" name="menustrs[]" id="menu_{$top2}" value="{$top2}" {if $menu2.check||$usermenus.$top2}checked="checked"{/if} 
		{if $menu2.check}disabled{/if}
		onclick="check_top('menu_{$top2}','menu_{$top}');clear_son('menu_{$top2}')">{$menu2.title}</label></td>
		<td style="color:#666;width:69%;line-height:18px;padding-left:12px;">
		{if count($menus.$top2)>0}
			{foreach from=$menus.$top2 item=menu3 key=top3}<div style="width:160px;float:left;"><label for="menu_{$top3}" TITLE='{$menu3.desc}'><input type="checkbox" name="menustrs[]" id="menu_{$top3}" value="{$top3}"{if $menu3.check||$usermenus.$top3}checked="checked"{/if} 
			{if $menu3.check}disabled{/if}
			onclick="check_top('menu_{$top3}','menu_{$top2}');check_top('menu_{$top3}','menu_{$top}')">{$menu3.title}</label></div>{/foreach}
		{else}
		&nbsp;
		{/if}
		</td>
</tr>{/foreach}
{/foreach} 
</table></div>

<div class="button-div" style="margin-top:-10px;padding:10px 0;background:#FFF;">
&nbsp;&nbsp;&nbsp;&nbsp;
<input type="hidden" name="adminid" value="{$user.adminid}">
<input type="submit" name="adminadd" id="adminadd" value="保存管理员" class='button'><input type="hidden" name="saveadmin" value="1"></div></form></div>

<script language="JavaScript">
{literal}
document.getElementById("tabbar-div").onmouseover = function(e)
{
    var obj = Utils.srcElement(e);
    if (obj.className == "tab-back")
    {
        obj.className = "tab-hover";
    }
}

document.getElementById("tabbar-div").onmouseout = function(e)
{
    var obj = Utils.srcElement(e);
    if (obj.className == "tab-hover")
    {
        obj.className = "tab-back";
    }
}

document.getElementById("tabbar-div").onclick = function(e)
{
    var obj = Utils.srcElement(e);
	//alert(obj.className);
    if (obj.className=='' || obj.className == "tab-front")
    {
        return;
    }
    else
    {
        objTable = obj.id.substring(0, obj.id.lastIndexOf("-")) + "-table";

        var tables = document.getElementsByTagName("table");
        var spans  = document.getElementsByTagName("span");

        for (i = 0; i < tables.length; i++)
        {
            if (tables[i].id == objTable)
            {
                tables[i].style.display = (Browser.isIE) ? "block" : "table";
            }
            else
            {
                tables[i].style.display = "none";
            }
        }
        for (i = 0; spans.length; i++)
        {
            if (spans[i].className != null && spans[i].className == "tab-front")
            {
                spans[i].className = "tab-back";
                obj.className = "tab-front";
                break;
            }
        }
    }
}

function showNotice(objId)
{
    var obj = document.getElementById(objId);

    if (obj)
    {
        if (obj.style.display != "block")
        {
            obj.style.display = "block";
        }
        else
        {
            obj.style.display = "none";
        }
    }
}
function checkAll(frm, checkbox)
{
  for (i = 0; i < frm.elements.length; i++)
  {
    if (frm.elements[i].name == 'action_code[]' || frm.elements[i].name == 'chkGroup')
    {
      frm.elements[i].checked = checkbox.checked;
    }
  }
}

function check(list, obj)
{
  var frm = obj.form;

    for (i = 0; i < frm.elements.length; i++)
    {
      if (frm.elements[i].name == "action_code[]")
      {
          var regx = new RegExp(frm.elements[i].value + "(?!_)", "i");

          if (list.search(regx) > -1) frm.elements[i].checked = obj.checked;
      }
    }
}

if (document.getElementById("listDiv"))
{
	document.getElementById("listDiv").onmouseover = function(e) {
    obj = Utils.srcElement(e);
    if (obj) {
		if (obj.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode;
		else if (obj.parentNode.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode.parentNode;
		else return;
			for (i = 0; i < row.cells.length; i++){
				if (row.cells[i].tagName != "TH") row.cells[i].style.backgroundColor = '#E7F4F5';
				}
			}
		}

	document.getElementById("listDiv").onmouseout = function(e) {
	obj = Utils.srcElement(e);
	if (obj) {
		if (obj.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode;
		else if (obj.parentNode.parentNode.tagName.toLowerCase() == "tr") row = obj.parentNode.parentNode;
		else return;
		  for (i = 0; i < row.cells.length; i++){
			  if (row.cells[i].tagName != "TH") row.cells[i].style.backgroundColor = '#FFF';
				}
			}
		}
}
{/literal}
</script>

{insert_scripts files="./js/validator.js"}
{literal}
<script language="JavaScript">
<!--
  /**
   * 检查表单输入的内容
   */
	function validate()
	{
		var validator = new Validator('listForm');
		validator.required('adminuser', "管理员用户名不能为空!");

		if( document.forms['listForm'].elements['adminpass2'].value.length < 6
			&& document.forms['listForm'].elements['adminpass2'].value.length > 0 )
		{
			validator.addErrorMsg('确认密码长度小于6位');
		}

		if( document.forms['listForm'].elements['adminpass'].value.length < 6
			&& document.forms['listForm'].elements['adminpass'].value.length > 0 )
		{
			validator.addErrorMsg('密码长度小于6位');
		}

		if( (document.forms['listForm'].elements['adminpass'].value.length > 0 || 
			document.forms['listForm'].elements['adminpass2'].value.length > 0 ) 
			&&  document.forms['listForm'].elements['adminpass'].value 
		 != document.forms['listForm'].elements['adminpass2'].value  
		 )
		{
			validator.addErrorMsg('两次输入的密码不一致');
		}

		return validator.passed();  
    }
//-->
</script>
{/literal}

{include file="pagefooter.html"}