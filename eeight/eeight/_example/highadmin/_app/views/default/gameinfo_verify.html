{include file="pageheader.html"}
{insert_scripts files="jquery.js"}
<script>
jQuery(document).ready(function(){
	jQuery(":input").change();//数据默认加载
	jQuery(":text").attr("readonly",true);
});
//组合计算
function c(n,m)
{
	if(m>n/2)
	{
		return c(n,n-m); 
	}
	else
	{
		if(m==0) return 1;
		d=1;
		for(t=1;t<=m;t++)
		{
			d= d*(n+1-t)/t;
		}
		return d;
	}
}
function jisuan(methodid,mode,level,totallevel)
{
	var total =jQuery("#totalmoney_"+methodid).val();
	if(mode==1)
	{
		val = jQuery("#prize_"+methodid+"_1").val();
		t = jQuery("#nocount_"+methodid+"_1").val();
		x = (total -val*t)/total;
		jQuery("#totalprofit_"+methodid).html(x.toFixed(3));
	}
	else if(mode==2)
	{
		//兼中兼得
		var val = new Array();
		var t = new Array();
		//获取各个奖级奖金和对应转直价格
		for(i=1;i<=level;i++)
		{
			val[i] = jQuery("#prize_"+methodid+"_"+i).val();
			t[i] = jQuery("#nocount_"+methodid+"_"+i).val();
			if(val[i]=="")
			{
				val[i] =0;
			}
			if(t[i]=="")
			{
				t[i] = 0;
			}
		}
		var money = new Array();
		moneys = 0;
		for(i=1;i<=level;i++)
		{
			moneys = moneys + val[i]*t[i];
		}//总返款
		x = (total -moneys)/total;
		jQuery("#totalprofit_"+methodid).html(x.toFixed(3));
		
	}
	else if(mode==3)
	{
		val = jQuery("#prize_"+methodid+"_"+level).val();
		t = jQuery("#nocount_"+methodid+"_"+level).val();
		x = (total -val*t)/total;
		jQuery("#totalprofit_"+methodid+"_"+level).html(x.toFixed(3));
	}
	else if(mode==4)
	{ //返奖率累加
		val = jQuery("#prize_"+methodid+"_"+level).val();
		if(val=="")
		{
			jQuery("#prize_"+methodid+"_"+level).val("0.00");
			val = 0.00;
		}
		t = jQuery("#nocount_"+methodid+"_"+level).val();
		x = (total -val*t)/total;
		jQuery("#totalprofit_"+methodid+"_"+level).html(x.toFixed(3));
		var val = new Array();
		var t = new Array();
		//获取各个奖级奖金和对应转直价格
		for(i=1;i<=totallevel;i++)
		{
			val[i] = jQuery("#prize_"+methodid+"_"+i).val();
			t[i] = jQuery("#nocount_"+methodid+"_"+i).val();
			if(val[i]=="")
			{
				val[i] =0;
				jQuery("#prize_"+methodid+"_"+i).val('0.00');
			}
			if(t[i]=="")
			{
				t[i] = 0;
			}
		}
		moneys = 0;
		for(i=1;i<=totallevel;i++)
		{
			moneys = moneys + val[i]*t[i];
		}//总返款
		x = (total -moneys)/total;
		jQuery("#totalprofit_"+methodid).html(x.toFixed(3));
	}
	jQuery("#userpoint_"+methodid).change();
}

function fandian( methodid,level,type)
{
	if(level>1)
	{ //非兼中兼得模式
		for(i=1;i<=level;i++)
		{
			totalprofit = jQuery("#totalprofit_"+methodid+'_'+i).html();
			userpoint=jQuery("#userpoint_"+methodid).val();
			x=totalprofit-userpoint;
			jQuery("#lastprofit_"+methodid+'_'+i).html(x.toFixed(3));
		}
		if(type==3){
		    totalprofit = jQuery("#totalprofit_"+methodid).html();
		    userpoint   = jQuery("#userpoint_"+methodid).val();
		    if(userpoint=="")
		    {
		        userpoint =0.00;
		        jQuery("#userpoint_"+methodid).val("0.00");
		    }
		    x = totalprofit-userpoint;
		    jQuery("#lastprofit_"+methodid).html(x.toFixed(3));
		}
	}
	else
	{ //单个返点模式
		totalprofit = jQuery("#totalprofit_"+methodid).html();
		userpoint   = jQuery("#userpoint_"+methodid).val();
		x           = totalprofit-userpoint;
		jQuery("#lastprofit_"+methodid).html(x.toFixed(3));
	}
}
</script>
<div class="list-div" id="listDiv">
<form action="?controller=gameinfo&action={$action|default:prizegroupadd}" method="post">
<input type="hidden" value="{$lotteryid}" name="lotteryid">
<table cellpadding="3" cellspacing="1">
<tr>

<th>彩种</th>
{if $crowdCount > 1}<th>玩法群</th>{/if}
<th width="100">玩法组</th>
<th width="250">奖金</th>
<th width="100">总利润空间</th>
<th width="100">总代返点</th>
<th width="100">公司留水</th>
<th width="100">状态</th>
</tr>
{foreach from=$amethod item=crowd key=k}
<tr align="center">
<td rowspan="{$crowd.count}"><b>{$crowd.cnname}</b></td>
{if $crowdCount > 1}<td rowspan="{$crowd.count}"><b>{$crowd.crowdname}</b></td>{/if}
{foreach from=$crowd.method item=method key=l}
{if $l != 0}
<tr align="center">
{/if}
<td align="center">{$method.methodname|eacape:html}<input type="hidden" id="totalmoney_{$method.methodid}" value="{$method.totalmoney}"></td>
<td align="left" style="padding-left:20px;">{foreach from=$method.nocount item=no key=k2}
{$no.name}:<input type="text" id="prize_{$method.methodid}_{$k2}" value="{$prizelevel.prize.$method.methodid.$k2}" size="10" onchange="jisuan({$method.methodid},{if $method.level==1}1{else}{if $method.type==1}2{elseif $method.type==3}4{else}3{/if}{/if},{if $method.level==1}{$k2}{else}{if $method.type==1}{$method.level}{else}{$k2}{/if}{/if},{if $method.type==3}{$method.level}{else}0{/if});">元
({$no.count}<input type="hidden" id="nocount_{$method.methodid}_{$k2}" value="{$no.count}">注)<br/>
{/foreach}</td>
<td align="center">
{if ($method.level>1)&&($method.type==0)}
{foreach from=$method.nocount item=no key=k2}
<span id="totalprofit_{$method.methodid}_{$k2}"></span><br/>
{/foreach}
{elseif ($method.level>1)&&($method.type==3)}
{foreach from=$method.nocount item=no key=k2}
<span id="totalprofit_{$method.methodid}_{$k2}"></span><br/>
{/foreach}
<font color="Red"><b>总计:<span id="totalprofit_{$method.methodid}"></span></b></font>
{else}
<span id="totalprofit_{$method.methodid}"></span>
{/if}
</td>
<td align="center"><input type="text" id="userpoint_{$method.methodid}" value="{$prizelevel.userpoint.$method.methodid|default:0.00}" size="10"
onchange="fandian({$method.methodid},{if $method.level==1}1{else}{if $method.type==1}1{else}{$method.level}{/if}{/if},{$method.type});"></td>
<td align="center">
{if ($method.level>1)&&($method.type==0)}
{foreach from=$method.nocount item=no key=k2}
<span id="lastprofit_{$method.methodid}_{$k2}"></span><br/>
{/foreach}
{elseif ($method.level>1)&&($method.type==3)}
{foreach from=$method.nocount item=no key=k2}
<span id="lastprofit_{$method.methodid}_{$k2}"></span><br/>
{/foreach}
<font color="Red"><b>总计:<span id="lastprofit_{$method.methodid}"></span></b></font>
{else}
<span id="lastprofit_{$method.methodid}"></span>
{/if}
</td>
<td align="center">{if $prizelevel.isclose.$method.methodid==0}可用{else}禁用{/if}</td>
</tr>
{/foreach}
{/foreach}
<tr>
<td colspan="2" class="narrow-label">奖组命名</td>
<td colspan="6">{$prizegroup.title}<input type="hidden" name="pgid" value="{$prizegroup.prizegroupid}"></td>
</tr>
<tr>
<td colspan="2" class="narrow-label">分配总代</td>
<td colspan="6">{foreach from=$user item=u key=k}<div style="width:100px;float:left;">{$u.username}</div>{/foreach}</td>
</tr>
<tr>
<td colspan="2" class="narrow-label"></td>
<td colspan="6"><input type="submit" class="button" value="通过审核" onclick="return confirm('您确定要审核通过吗?');"></td>
</tr>
</table>
</form>
</div>
{include file="pagefooter.html"}
