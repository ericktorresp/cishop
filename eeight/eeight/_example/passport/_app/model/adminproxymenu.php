<?php/** * 总代管理员组权限模型 * * 功能： *		-- get		读取组的权限字段 * 		-- insert		增加权限 *  * @author	Floyd * @version 1.0.0 * @package	highgame * @since 	2010/05/24 */class model_adminproxymenu extends basemodel {	/**	 * 构造函数	 * 	 * @access	public	 * @return	void	 */	function __construct( $aDBO=array() )	{		parent::__construct( $aDBO );	}	/**	 * 增加总代管理员组权限	 * 	 * @access 	public	 * @param	int		$iGroupId	//要继承的组ID	 * @param	array		$aValue	//字段值	 * @return 	mixed		//失败返回FALSE，成功返回TRUE	 */	public function insert( $aValue = array() )	{		if(!is_array($aValue))		{			return FALSE;		}		if(!isset($aValue['groupid']) || !isset($aValue['menustrs']) || !isset($aValue['ownerid']))		{			return FALSE;		}		$this->oDB->insert('admin_proxy_menu', $aValue);		if( $this->oDB->errno() > 0 )		{			return FALSE;		}		return TRUE;	}	public function get($iGroupId)	{		if( empty($iGroupId) || !is_numeric($iGroupId) )		{			return FALSE;		}		$sSql = " SELECT `menustrs` FROM `admin_proxy_menu` WHERE `groupid`='". intval($iGroupId) ."'";		return $this->oDB->getOne( $sSql );	}	public function syncAdminProxyMenu($aParams=array())	{		$this->oDB->doTransaction();		$oProxyGroup = new model_proxygroup();		$iProxyGroupId = $oProxyGroup->proxyGroupInsert($aParams['groupname'], $aParams['ownerid'], '', $aParams['groupid'], '',$aParams['issales']);		if(!$iProxyGroupId)		{			$oProxyGroup->oDB->doRollback();			return -1;		}		$aValue = array('groupid'=>$iProxyGroupId);		if($aParams['groupid'])		{			$aAdminProxyMenu = $this->get( $aParams['groupid'] );			$aValue['menustrs'] = $aAdminProxyMenu['menustrs'];			$sWhere = 'groupid = '.$aParams['groupid'].' AND userid IN (SELECT userid FROM usertree WHERE usertype=2 AND parentid='.$aParams['ownerid'].')';			$userchannelValue = array('groupid'=>$iProxyGroupId);		}		else		{			$aValue['menustrs'] = '';		}		$aValue['ownerid'] = $aParams['ownerid'];		$mResult = $this->insert( $aValue );        if( TRUE === $mResult )        {			if(isset($sWhere))			{				$this->oDB->update('userchannel',$userchannelValue,$sWhere);				if($this->oDB->errno()>0)				{					$this->oDB->doRollback();					return -2;				}			}			$this->oDB->doCommit();			return $iProxyGroupId;        }        else        {			$this->oDB->doRollback();			return -2;        }	}}?>