{include file="pageheader.html"}
<script>
(function($){
$(document).ready(function(){
	totalmoney = Number({$user.availablebalance});
	$("#total").html(totalmoney);
	{foreach from=$channels.0 item=channel key=k}
	$.ajax({
		type : 'POST',
		url  : './?controller=report&action=account',
		data : "flag=getdata&channelid="+{$k},
		async   : false,
		timeout : 20000,
		cache	: true,
		success : function(data){
					  if( data == "error" ){
					  	  $("#channel_{$k}").html("读取数据出错");
					  }else if( data.length > 20 )
					  {
					  	  $("#channel_{$k}").html("读取数据出错");
					  }else{
					  	  data = Number(data);
						  totalmoney += data;
						  data = data < 0 ? "<font color='red'>"+moneyFormat(data)+"</font>" : moneyFormat(data);
						  totalmoneyhtml = totalmoney < 0 ? "<font color='red'>"+moneyFormat(totalmoney)+"</font>" : moneyFormat(totalmoney);
					  	  $("#channel_{$k}").html(data);
						  $("#total").html(totalmoneyhtml);
					  }
				  },
		error: function(){ $("#channel_{$k}").html("读取数据出错"); }
	});
	{/foreach}
});
})(jQuery);
</script>
</head>
<body>
<div class="list-div" id="listDiv">
<table class="list-table">
	<tr>
    	<td class="narrow-label">用户名</td>
        <td>{$user.username|escape:html}</td>
    </tr>
    <tr>
    	<td  class="narrow-label">银行余额</td>
        <td><span id="channel_0">{$user.availablebalance|escape:money}</span></td>
    </tr>
    {foreach from=$channels.0 item=channel key=k}
    <tr>
    	<td class="narrow-label">{$channel.channel}余额</td>
        <td><span id="channel_{$k}">正在获取数据.......</span></td>
    </tr>
    {/foreach}
    <tr>
    	<td class="narrow-label">总计</td>
        <td><span id="total">{$user.availablebalance|escape:money}</span></td>
    </tr>
</table>
</div>
{include file="pagefooter.html"}