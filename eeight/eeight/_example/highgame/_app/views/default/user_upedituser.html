{include file="pageheader.html"}
<script type="text/javascript" src="{$sSystemImagesAndCssPath}/highgame/js/dialogUI/jquery.dragdrop.js"></script>
<script type="text/javascript" src="{$sSystemImagesAndCssPath}/highgame/js/dialogUI/jquery.dialogUI.js"></script>
<LINK href="{$sSystemImagesAndCssPath}/highgame/css/default/dialogUI.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
jQuery.noConflict();
(function($){
	var prizegroup 	= [];	//奖金组堆栈
	var usermethod	= [];	//用户的奖金详情堆栈
	var childmethod = [];	//下级用户奖金详情堆栈
	var lotteryinfo = [];
	var issave		= true;
	//初始化
	{foreach from=$lotterys item=lottery key=k}
	lotteryinfo.push({minpoint:Number({$lottery.mincommissiongap})*100,lotteryid:parseInt({$lottery.lotteryid},10)});
	{/foreach}
	var usertype	= parseInt({$user.usertype},10);

	//返点输入框输入过滤
	function filterPercent(num){
		num = num.replace(/^[^\d]/g,'');
		num = num.replace(/[^\d.]/g,'');
		num = num.replace(/\.{2,}/g,'.');
		num = num.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
		if( num.indexOf(".") != -1 ){
			var data = num.split('.');
			num = (data[0].substr(0,3))+'.'+(data[1].substr(0,1));
		}else{
			num = num.substr(0,3);
		}
		return num;
		num = num > 100 ? 100 : num;
		return num;
	}
	//金额逗号分隔格式化
	function moneyFormat(num){
		num = num.toString().replace(/[^\d]/g,"").substr(0,15);
		num = Number(num).toString();
		var newnum = [];
		for( i=num.length; i>0; i-=3 ){
			newnum.unshift(num.substring(i,i-3));
		}
		num = newnum.join(",");
		return num;
	}
	//获取金额实际数字
	function moneyNumber(num){
		return num ? Number(num.replace(/[^\d]/g,"")) : 0;
	}
	//获取能设置的最大返点以及最小返点
	function getMinMaxPoint( lotteryid, methodid, userpoint ){
		pointrange = {minpoint:0,maxpoint:Number(userpoint)};
		lotteryid  = parseInt(lotteryid,10);
		methodid   = parseInt(methodid,10);
		mincoor	   = 0;
		//获取最大返点
		$.each(lotteryinfo,function(i,n){
			if( n.lotteryid == lotteryid ){
				mincoor = n.minpoint;
			}
		});
		pointrange.maxpoint = Math.floor((pointrange.maxpoint-mincoor)*10)/10;
		pointrange.maxpoint = pointrange.maxpoint > 0 ? pointrange.maxpoint : 0;
		//获取最小返点
		if( childmethod != "" && childmethod != null ){
			$.each(childmethod,function(i,n){
				if( i == methodid ){
					n = Number(n);
					if( n == 0 || userpoint < mincoor ){
						pointrange.minpoint = 0;
					}
					else{
						pointrange.minpoint += n+mincoor;
					}
				}
			});
		}
		return pointrange;
	}
	/*************************************/
	$(document).ready(function(){
		/*******************提交数据*******************/
		$("#subform").click(function(){
			$("span[class='merror']").hide();
			$.blockUI({message:"<h3>正在提交数据.....<br><img src='{$sSystemImagesAndCssPath}/highgame/images/default/loading.gif'></h3>"});
			if( $("#lotteryid").val() == "" || Number($("#lotteryid").val()) == 0 || isNaN(Number($("#lotteryid").val())) ){
				$.alert("数据错误，请刷新页面");
				return false;
			}
			if( $("#uid").val() == "" || Number($("#uid").val()) == 0 || isNaN(Number($("#uid").val())) ){
				$.alert("数据错误，请刷新页面");
				return false;
			}
			//检测返点是否正确设置
			isverfer = true;
			$("input[type='checkbox'][id^='method_']").each(function(){
				if( $(this).attr("checked") ==  true ){
					id   = parseInt($(this).val(),10);
					maxp = Number($("input[name='maxpoint_"+id+"']").val());
					minp = Number($("input[name='minpoint_"+id+"']").val());
					point= Number($("input[name='point_"+id+"']").val());
					if( point > maxp || point < minp ){
						$("input[name='point_"+id+"']").nextAll("span").html('&nbsp;<img src="{$sSystemImagesAndCssPath}/highgame/images/default/no.gif" align="absmiddle">').show();
						isverfer = false;
					}
				}
			});
			if( isverfer == false ){
				$.alert("返点设置错误，请检查");
				return false;
			}
			var form = $("#adjustform");
			/*AJAX提交数据*/
			$.ajax({
				type	: 'POST',
				url  	: './?controller=user&action=upedituser',
				timeout : 20000,
				data	: $(form).serialize(),
				global	: false,
				success	: function(data){
							var partn = /<script.*>.*<\/script>/;
							if( data.toLowerCase() == "true" ){
								//alert('操作成功');
							    $.alert('操作成功','温馨提示');
								$("#prizegroupselect").attr("disabled",true);
								issave = true;
							}else if( partn.test(data) ){
								alert("登陆超时，或者帐户在其他地方登陆，请重新登陆");
								top.location.href="../?controller=default";
								return false;
							}else{
								$.alert(data);
							}
						},
				error	: function(){
							$.alert("提交数据失败，请重试");
							return false;
						}
			});
			//$(form).submit();
		});
		
		//生成奖金组下拉菜单
		function getPrizeSelect(selID){
			if( selID ){
				selID = parseInt(selID,10);
			}else{
				selID = 0;
			}
			var html = "";
			if( usertype == 1 && selID == 0 ){
				html += '<select name="prizegroupselect" id="prizegroupselect">';
				$.each(prizegroup,function(i,n){
					if( selID == parseInt(n.pgid,10) ){
						selhtml = 'selected="selected"';
					}else{
						selhtml = '';
					}
					html += '<option value="'+n.pgid+'" '+selhtml+'>'+replaceHTML(n.title)+'</option>';
				});
				html += '</select>';
				html += '<input type="hidden" name="prizegroup" id="prizegroup" value="'+prizegroup[0].pgid+'">';
			}else if( usertype !== 1 && selID == 0 ){
				html = '<input type="hidden" name="prizegroup" id="prizegroup" value="'+prizegroup[0].pgid+'">'+replaceHTML(prizegroup[0].title);
			}else{
				$.each(prizegroup,function(i,n){
					if( selID == parseInt(n.pgid,10) ){
						html = '<input type="hidden" name="prizegroup" id="prizegroup" value="'+n.pgid+'">'+replaceHTML(n.title);
					}
				});
				if( html == "" ){
					alert("加载数据出错");
					window.history.back(-1);
				}
			}
			return html;
		}
		//根据所选择的奖金组生成相应的返点设置内容
		$.fn.cratePrizeHtml = function(id){
			if( id ){
				id = parseInt(id,10);
			}else{
				if( prizegroup[0] ){//默认为第一组
					id = parseInt(prizegroup[0].pgid,10);
				}else{//没有相应数据
					return false;
				}
			}
			var isright = false;
			var pid = 0;
			for( i=0; i<prizegroup.length; i++ ){
				if( id == parseInt(prizegroup[i].pgid,10) ){
					isright = true;
					pid = i;
					break;
				}
			}
			if( isright == false ){//没有找到相应数据
				return false;
			}
			var html = "";
			var specialhtml = "";
			var	ischeck    = "";
			var	upoint	   = "";
			var	prizehtml  = "";
			var	methodname = "";
			var	userpoint  = 0;
			var	lotteryid  = 0;
			$.each(prizegroup[pid].method,function(i,n){
				ischeck    = "";
				upoint	   = "";
				prizehtml  = "<div style='text-align:left;width:100px;'>";
				methodname = "";
				userpoint  = 0;
				lotteryid  = 0;
				if( usermethod.length > 0 ){//如果有设置值
					$.each(usermethod[0].method,function(j,m){
						if( i == m.methodid ){
							ischeck = 'checked="checked"';
							upoint	= m.userpoint;
						}
					});
				}
				$.each(n,function(k,v){
					methodname = v.methodname;
					userpoint  = v.userpoint;
					lotteryid  = v.lotteryid;
					switch( parseInt(v.level) ){
						case 1 : prizehtml  += replaceHTML(v.nocount[1].name)+"："+Number(v.prize)+"元"; break;
						case 2 : prizehtml  += "<br />"+replaceHTML(v.nocount[2].name)+"："+Number(v.prize)+"元"; break;
						case 3 : prizehtml  += "<br />"+replaceHTML(v.nocount[3].name)+"："+Number(v.prize)+"元"; break;
						default: break;
					}
				});
				prizehtml  += "</div>";
				pointrange = getMinMaxPoint( lotteryid, i, userpoint );
				if( i == 17 || i == 31 || i == 93 || i == 141 || i == 196 || i == 280 ){
					specialhtml += '<tr><td><span class="james_left"><input type="checkbox" name="method[]" id="method_'+i+'" value="'+i+'" '+ischeck+'> '+replaceHTML(methodname)+'</span></td><td align="center">'+prizehtml+'</td><td>返点 <input type="text" class="fandianinput" value="'+upoint+'" name="point_'+i+'"><input type="hidden" name="minpoint_'+i+'" value="'+pointrange.minpoint+'"><input type="hidden" name="maxpoint_'+i+'" value="'+pointrange.maxpoint+'">% (范围：'+pointrange.minpoint+'~'+pointrange.maxpoint+'%)<span class="merror"></span></td></tr>';
				}else if( i == 5 || i == 32 ){
					html = '<tr><td><span class="james_left"><input type="checkbox" name="method[]" id="method_'+i+'" value="'+i+'" '+ischeck+'> '+replaceHTML(methodname)+'</span></td><td align="center">'+prizehtml+'</td><td>返点 <input type="text" class="fandianinput" value="'+upoint+'" name="point_'+i+'"><input type="hidden" name="minpoint_'+i+'" value="'+pointrange.minpoint+'"><input type="hidden" name="maxpoint_'+i+'" value="'+pointrange.maxpoint+'">% (范围：'+pointrange.minpoint+'~'+pointrange.maxpoint+'%)<span class="merror"></span></td></tr>'+html;
				}else{
					html += '<tr><td><span class="james_left"><input type="checkbox" name="method[]" id="method_'+i+'" value="'+i+'" '+ischeck+'> '+replaceHTML(methodname)+'</span></td><td align="center">'+prizehtml+'</td><td>返点 <input type="text" class="fandianinput" value="'+upoint+'" name="point_'+i+'"><input type="hidden" name="minpoint_'+i+'" value="'+pointrange.minpoint+'"><input type="hidden" name="maxpoint_'+i+'" value="'+pointrange.maxpoint+'">% (范围：'+pointrange.minpoint+'~'+pointrange.maxpoint+'%)<span class="merror"></span></td></tr>';
				}
			});
			html = specialhtml+html;
			$html = $(html);
			//先清除原来的内容
			$(this).closest("tr").nextAll().remove();
			$html.insertAfter($(this).closest("tr"));
			$("input[type='text'][name^='point_']",$html).keyup(function(){
				$(this).val( filterPercent($(this).val()) );
				$(this).closest("tr").find("input[type='checkbox']").attr("checked",true);
			});
		}
		/****************************根据彩种加载返点设置界面***********************************/
		$("span",$("#tabbar-div")).click(function(){
			if( $(this).attr("class") == "tab-front" ){
				return false;
			}
			if( $("#tabloading").css("display") != "none" ){
				return false;
			}
			if( issave == false ){
				if( false == confirm("内容未保存，继续将丢失已做的改动，你确定继续吗？") ){
					return false;
				}
			}
			$("span",$("#tabbar-div")).attr("class","tab-back");
			$(this).attr("class","tab-front");
			$("#tabloading").ajaxStart(function(){
				$(this).show();
				$("#tabloading").nextAll().remove();
			}).ajaxStop(function(){
				$(this).hide();
			}).ajaxError(function(){
				$(this).hide();
				$('<tr><td align="center" colspan="10">加载数据出错</td></tr>').appendTo("#detail-table");
			});
			var lotteryid = $(this).attr("id");
			$("#lotteryid").val(lotteryid);
			$.ajax({
				type : 'POST',
				url  : './?controller=user&action=upedituser',
				data : "flag=method&uid={$user.userid}&lotteryid="+lotteryid,
				timeout : 20000,
				cache	: true,
				success : function(data){
							if( data == "error" ){//没有相关彩种
								$('<tr><td align="center" colspan="10">加载数据出错</td></tr>').appendTo("#detail-table");
							}else if( data == "empty" ){
								$('<tr><td align="center" colspan="10">无数据</td></tr>').appendTo("#detail-table");
							}else{
								var partn = /<(.*)>.*<\/\1>/;
								if( partn.exec(data) ){
									window.top.location.href="/index.php?controller=default";
									return false;
								}
								data = data.replace(/<script>/g,"");
								data = data.replace(/<\/script>/g,"");
								data = data.replace(/<\\\/script>/g,"");
								data = eval(data);
								if( typeof(data) != 'object' ){
									window.top.location.href="/index.php?controller=default";
									return false;
								}
								prizegroup  = data[0].prizes;	//清空历史数据
								usermethod  = data[0].userset;
								childmethod = data[0].childset;
								var html = '<tr><td align="center" width="150">统一奖金与返点值设置</td><td align="center">'+getPrizeSelect(usermethod.length>0 ? usermethod[0].pgid : 0)+'</td><td width="40%">返点 <input type="text" class="fandianinput" value="0" name="accord_point" id="accord_point">% <input type="button" name="accordbutton" id="accordbutton" class="button" value="统一设置"></td></tr>';
								$html = $(html);
								$html.insertAfter("#tabloading");
								if( usermethod.length > 0 ){
									$("#prizegroup").cratePrizeHtml(usermethod[0].pgid);
								}else{
									$("#prizegroup").cratePrizeHtml(0);
								}
								$("#prizegroupselect").change(function(){
									$(this).cratePrizeHtml($("option:selected",this).val());
									$("#prizegroup").val($("option:selected",this).val());
								});
								$("#accordbutton").click(function(){
									$("input[type='text'][name^='point_'][name!='point_17'][name!='point_31'][name!='point_93'][name!='point_141'][name!='point_196'][name!='point_280']",$('#adjustform')).val(Number($("#accord_point").val()));
									$("input[type='checkbox'][id^='method_'][id!='method_17'][id!='method_31']").attr("checked",true);
									//$("#selectall").attr("checked",true);
								});
								$("#accord_point").keyup(function(){
									$(this).val( filterPercent($(this).val()) );
								});
								$("#selectall").attr("checked",false);
								issave = false;
								return true;
							}
						},
				error : function(r,t,e){
				 			$('<tr><td align="center" colspan="10">加载数据出错</td></tr>').appendTo("#detail-table");
				 		}
			});
		});
		//默认载入的彩种
		var defaultId = Number({$lotteryid});
		if( defaultId == 0 ){//默认第一个
			$("span:first",$("#tabbar-div")).click();
		}else{
			var isfind = false;
			$.each($("span",$("#tabbar-div")),function(i,n){
				if( Number($(n).attr("id")) == defaultId ){
					isfind = true;
					$(n).click();
				}
			});
			if( isfind == false ){//没有找到则默认到第一个
				$("span:first",$("#tabbar-div")).click();
			}
		}
		$("#accord_lottery_point,#accord_indefinite_point,input[type='text'][id^='point_'],input[type='text'][id^='indefinite_point_']").keyup(function(){
			$(this).val( filterPercent($(this).val()) );
		});
		$("#accord_lottery_button").click(function(){
			var point = Number($("#accord_lottery_point").val());
			$("input[type='text'][id^='point_']").val(point);
			$("input[type='checkbox'][id^='lottery_']").attr("checked",true);
		});
		$("#accord_indefinite_button").click(function(){
			$("input[type='text'][id^='indefinite_point_']").val(Number($("#accord_indefinite_point").val()));
			$("input[type='checkbox'][id^='lottery_']").attr("checked",true);
		});
		$("select[id^='pg_select_']").each(function(){
			$(this).change(function(){
				var lid = $(this).attr('id').replace('pg_select_','');
				$("span[id^=range_"+lid+'_]').hide();
				var pgid = $("option:selected",this).val();
				$("#range_"+lid+"_"+pgid).show();
				tmp = $('#range_'+lid+'_'+pgid).text().split('：');
				tmp = tmp[1].split('%');
				range = tmp[0].split('～');
				$('#min_point_'+lid).val(range[0]);
				$('#max_point_'+lid).val(range[1]);
				if($('#min_indefinite_point_'+lid).length)
				{
					$("span[id^=range_i_"+lid+'_]').hide();
					var pgid = $("option:selected",this).val();
					$("#range_i_"+lid+"_"+pgid).show();
					tmp = $('#range_i_'+lid+'_'+pgid).text().split('：');
					tmp = tmp[1].split('%');
					range = tmp[0].split('～');
					$('#min_indefinite_point_'+lid).val(range[0]);
					$('#max_indefinite_point_'+lid).val(range[1]);
				}
			});
		});
	});
})(jQuery);
//全选，取消全选
function selectAll(obj)
{
	var objs = jQuery("input[type='text'][name^='point_']");
	objs.each(function(){
		if(jQuery(this).val() == '')
		{
			jQuery(this).val('0');
		}
	});
	jQuery(":checkbox[id!='"+obj+"']").attr("checked",jQuery("#"+obj).attr("checked"));
}
function selectAllLottery(obj)
{
	var objs = jQuery(jQuery("input[type='text']"),jQuery('#lotteriesform'));
	objs.each(function(){
		if(jQuery(this).val() == '')
		{
			jQuery(this).val('0');
		}
	});
	jQuery(":checkbox[id!='"+obj+"']",jQuery('#lotteriesform')).attr("checked",jQuery("#"+obj).attr("checked"));
}
function checkRapid()
{
	var form = jQuery('#lotteriesform');
	var boxes = jQuery(":checkbox[id!='selectalllottery']",form);
	var total = boxes.length;
	var notchecked = 0;
	for(var i=0;i<total;i++)
	{
		if(!jQuery(boxes[i]).attr('checked'))
		{
			notchecked++;
			continue;
		}
		var id = jQuery(boxes[i]).attr('id').replace('lottery_','');
		maxp = Number(jQuery("#max_point_"+id).val());
		minp = Number(jQuery("#min_point_"+id).val());
		point= Number(jQuery("#point_"+id).val());
		maxip = Number(jQuery("#max_indefinite_point_"+id).val());
		minip = Number(jQuery("#min_indefinite_point_"+id).val());
		ipoint= Number(jQuery("#indefinite_point_"+id).val());
		if( point > maxp || point < minp || ipoint > maxip || ipoint < minip )
		{
			alert('返点设置错误，请检查');
			return false;
		}
		jQuery("#point_"+id).val(point);
		jQuery("#indefinite_point_"+id).val(ipoint);
	}
	if(notchecked == total)
	{
		alert("请选择要设置返点的彩种");
		return false;
	}
	return true;
}
//function changeUserPrizeGroup(lotteryid)
//{
	//if(!lotteryid)
	//{
		//return false;
	//}
	//jQuery("[id^=range_"+lotteryid+'_]').toggle();
	//jQuery("[id^=range_i_"+lotteryid+'_]').toggle();
	//var pgid = jQuery('#pg_select_'+lotteryid).val();
	//tmp = jQuery('#range_'+lotteryid+'_'+pgid).text().split('：');
	//tmp = tmp[1].split('%');
	//range = tmp[0].split('～');
	//jQuery('#min_point_'+lotteryid).val(range[0]);
	//jQuery('#max_point_'+lotteryid).val(range[1]);
	//if(jQuery('#min_indefinite_point_'+lotteryid).length)
	//{
		//tmp = jQuery('#range_i_'+lotteryid+'_'+pgid).text().split('：');
		//tmp = tmp[1].split('%');
		//range = tmp[0].split('～');
		//jQuery('#min_indefinite_point_'+lotteryid).val(range[0]);
		//jQuery('#max_indefinite_point_'+lotteryid).val(range[1]);
	//}
//}
</script>
<style type="text/css">
.fandianinput{width:40px; text-align:center;}
</style>
<div class="tab-div">
<table cellpadding="0" cellspacing="0">
	<tr>
    	<td width="100" align="right" height="20">用户名称：&nbsp;&nbsp;</td>
        <td>{$user.username}</td>
    </tr>
    <tr>
    	<td align="right" height="20">用户呢称：&nbsp;&nbsp;</td>
        <td>{$user.nickname}</td>
    </tr>
    <tr>
    	<td align="right" height="20">奖金限额：&nbsp;&nbsp;</td>
        <td>{$user.limitbons}</td>
    </tr>
</table>
</div>
<div class="tab-div">
<form action="./?controller=user&action=upedituser" method="post" name="lotteriesform" id="lotteriesform" onSubmit='return checkRapid();'>
<input type="hidden" name="flag" id="flag" value="rapid" />
<input type="hidden" name="uid" id="uid" value="{$user.userid}" />
<div class="list-div">
<table cellpadding="0" cellspacing="1" cellpadding="3">
	<tr>
    	<th colspan='4' style="text-align:left;padding-left:10px;"><b>快速设置返点</b></th>
    </tr>
	<tr>
		<td style="padding:3px;" width="150">彩种</td>
		<td style="padding:3px;">奖金组</td>
		<td style="padding:3px;"><input type="text" class="fandianinput" value="0" name="accord_lottery_point" id="accord_lottery_point">% <input type="button" name="accordbutton" id="accord_lottery_button" class="button" value="统一设置"></td>
		<td style="padding:3px;"><input type="text" class="fandianinput" value="0" name="accord_indefinite_point" id="accord_indefinite_point">% <input type="button" name="accordbutton" id="accord_indefinite_button" class="button" value="统一设置不定位"></td>
	</tr>
	{foreach from=$lotterys item=lottery key=k}
	<tr>
		<td style="padding:3px;" width="150"><label for="pg_select_{$lottery.lotteryid}"><input type="checkbox" name='lottery[]' id="lottery_{$lottery.lotteryid}" value="{$lottery.lotteryid}">{$lottery.cnname}</label></td>
		<td style="padding:3px;">
			{if $lottery.setted}
			<input type="hidden" name="pg_{$lottery.lotteryid}" value="{$lottery.setted.userpgid}">
			{$lottery.setted.title}
			{elseif $user.usertype != 1}
			<input type="hidden" name="pg_{$lottery.lotteryid}" value="{$lottery.pg.0.userpgid}">
			{$lottery.pg.0.title}
			{else}
			<select id="pg_select_{$lottery.lotteryid}" name="pg_{$lottery.lotteryid}">
			{foreach from=$lottery.pg item=pg}
			<option value="{$pg.userpgid}">{$pg.title}</option>
			{/foreach}
			</select>
			{/if}
		</td>
		<td style="padding:3px;">
			{if $lottery.setted}
			<input type="hidden" name="min_point_{$lottery.lotteryid}" id="min_point_{$lottery.lotteryid}" value="{$lottery.setted.min}">
			<input type="hidden" name="max_point_{$lottery.lotteryid}" id="max_point_{$lottery.lotteryid}" value="{if $lottery.setted.max<0}0{else}{$lottery.setted.max}{/if}">
			<input type="text" size="20" class="fandianinput" id="point_{$lottery.lotteryid}" name="point_{$lottery.lotteryid}" value="{$lottery.setted.cur}">%
			<span id="range_{$lottery.setted.userpgid}">(范围：{$lottery.setted.min}～{if $lottery.setted.max<0}0{else}{$lottery.setted.max}{/if}%)</span>
			{else}
			{foreach from=$lottery.pg item=pg key=k}
			{if $k==0}
			<input type="hidden" name="min_point_{$lottery.lotteryid}" id="min_point_{$lottery.lotteryid}" value="{$pg.min}">
			<input type="hidden" name="max_point_{$lottery.lotteryid}" id="max_point_{$lottery.lotteryid}" value="{if $pg.max<0}0{else}{$pg.max}{/if}">
			<input type="text" size="20" class="fandianinput" id="point_{$lottery.lotteryid}" name="point_{$lottery.lotteryid}" value="{$pg.cur}">%
			{/if}
			<span id="range_{$lottery.lotteryid}_{$pg.userpgid}"{if $k!=0} style="display:none;"{/if}>(范围：{$pg.min}～{if $pg.max<0}0{else}{$pg.max}{/if}%)</span>
			{/foreach}
			{/if}
		</td>
		<td style="padding:3px;">
		{if $lottery.lotteryid != 5 && $lottery.lotteryid != 7 && $lottery.lotteryid != 8}
			{if $lottery.setted}
			<input type="hidden" name="min_indefinite_point_{$lottery.lotteryid}" id="min_indefinite_point_{$lottery.lotteryid}" value="{$lottery.setted.minIndefinite}">
			<input type="hidden" name="max_indefinite_point_{$lottery.lotteryid}" id="max_indefinite_point_{$lottery.lotteryid}" value="{if $lottery.setted.maxIndefinite<0}0{else}{$lottery.setted.maxIndefinite}{/if}">
			<input type="text" size="20" class="fandianinput" id="indefinite_point_{$lottery.lotteryid}" name="indefinite_point_{$lottery.lotteryid}" value="{$lottery.setted.curIndefinite}">%
			(范围：{$lottery.setted.minIndefinite}～{if $lottery.setted.maxIndefinite<0}0{else}{$lottery.setted.maxIndefinite}{/if}%)<br />
			{else}
			{foreach from=$lottery.pg item=pg key=k}
			{if $k==0}
			<input type="hidden" name="min_indefinite_point_{$lottery.lotteryid}" id="min_indefinite_point_{$lottery.lotteryid}" value="{$pg.minIndefinite}">
			<input type="hidden" name="max_indefinite_point_{$lottery.lotteryid}" id="max_indefinite_point_{$lottery.lotteryid}" value="{if $pg.maxIndefinite<0}0{else}{$pg.maxIndefinite}{/if}">
			<input type="text" size="20" class="fandianinput" id="indefinite_point_{$lottery.lotteryid}" name="indefinite_point_{$lottery.lotteryid}" value="{$pg.curIndefinite}">%
			{/if}
			<span id="range_i_{$lottery.lotteryid}_{$pg.userpgid}"{if $k!=0} style="display:none;"{/if}>(范围：{$pg.minIndefinite}～{if $pg.maxIndefinite<0}0{else}{$pg.maxIndefinite}{/if}%)</span>
			{/foreach}
			{/if}
		{/if}
		</td>
	</tr>
	{/foreach}
	<tr>
		<td colspan="4" align="center">
			<input type="checkbox" onclick="selectAllLottery('selectalllottery')" id="selectalllottery">全选 &nbsp;&nbsp;
        	<input type="submit" class="button" value="提交" id="lotteriesform">&nbsp;&nbsp;
		</td>
	</tr>
</table>
</div>
</form>
</div>
<div class="tab-div">
<form action="./index.php" method="post" name="adjustform" id="adjustform">
<input type="hidden" name="lotteryid" id="lotteryid" value="" />
<input type="hidden" name="flag" id="flag" value="insert" />
<input type="hidden" name="uid" id="uid" value="{$user.userid}" />
  <div id="tabbar-div">
  {foreach from=$lotterys item=lottery key=k}
  	<span class="tab-back" id="{$lottery.lotteryid}">{$lottery.cnname}</span>
  {/foreach}
  </div>
<br />
	{* 标签 : 基本信息 *}
  <div class="list-div" id="listDiv">
  	<table cellspacing='1' cellpadding='3' id='detail-table'>
        <tr id="tabloading" style="display:none;">
        	<td colspan="10" height="100" align="center" valign="middle">正在初始化......<br><img src="{$sSystemImagesAndCssPath}/highgame/images/default/loading.gif"></td>
        </tr>
        <tr>
        	<td align="center" width="150">统一奖金与返点值设置</td>
            <td align="center">奖金 1700</td>
            <td width="40%">返点 <input type="text" class="fandianinput" value="0" name="accord_point" id="accord_point">% <input type="button" name="accordbutton" id="accordbutton" class="button" value="统一设置"></td>
        </tr>
        <tr>
        	<td><span class="james_left"><input type="checkbox" name="method_1"> 直选</span></td>
            <td align="center">奖金 1700</td>
            <td>返点 <input type="text" class="fandianinput" value="0" name="point_1">% (范围：<span>0~9.0%</span>)</td>
        </tr>
    </table>
    <table cellspacing='1' cellpadding='3' id='detail-table'>
    	<tr>
        	<td align="center"><input type="checkbox" name="selectall" id="selectall" onclick="selectAll('selectall')"  />全选 &nbsp;&nbsp;
        				<input type="button" name="subform" id="subform" value="提交" class='button' />&nbsp;&nbsp;
                        <input type="button" class='button' onclick="window.location='{$actionlink.href}'" value="返回列表" /></td>
        </tr>
    </table>
  </div>
</form>
</div>


<script language="JavaScript">
jQuery('#tabbar-div').mouseover(function() {
    if (jQuery('#tabbar-div').hasClass("tab-back"))
    {
        jQuery('#tabbar-div').addClass("tab-hover");
    }
});
jQuery('#tabbar-div').mouseout(function() {
    if (jQuery('#tabbar-div').hasClass("tab-hover"))
    {
        jQuery('#tabbar-div').addClass("tab-back");
    }
});

function showNotice(objId)
{
    var obj = document.getElementById(objId);

    if (obj)
    {
        if (obj.style.display != "block")
        {
            obj.style.display = "block";
        }
        else
        {
            obj.style.display = "none";
        }
    }
}
</script>

{include file="pagefooter.html"}