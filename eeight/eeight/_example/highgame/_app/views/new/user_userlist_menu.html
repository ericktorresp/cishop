<html>
<head>
<title>用户管理</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="{$sSystemImagesAndCssPath}/highgame/css/default/general.css" type="text/css" />
<script language="javascript" type="text/javascript" src="{$sSystemImagesAndCssPath}/highgame/js/jquery.js"></script>
<script language="javascript" type="text/javascript" src="{$sSystemImagesAndCssPath}/highgame/js/common.js"></script>
<script language="javascript" type="text/javascript" src="{$sSystemImagesAndCssPath}/highgame/js/dialogUI/jquery.dialogUI.js"></script>
<script type="text/javascript">
jQuery.blockUI.defaults.message = '加载数据...'; 
jQuery.blockUI.defaults.css = { 
        padding:        0, 
        margin:         '0 auto', 
        width:          '100px', 
        top:            '4px', 
        left:           '8px', 
        textAlign:      'center', 
        color:          '#FF0000', 
        border:         '1px solid #80BDCB', 
        backgroundColor:'#FFF', 
        cursor:         'wait' 
    };
jQuery.blockUI.defaults.overlayCSS = { 
        backgroundColor: '#CCC', 
        opacity:         0.5 
    };
jQuery.blockUI.defaults.centerX = false;
jQuery.blockUI.defaults.centerY = false;
function getChildList( obj, uid )
{
	if( jQuery(obj).parent().find("ul").html() != null )
	{
		if( jQuery(obj).attr("src") == "{$sSystemImagesAndCssPath}/highgame/images/default/icon_05.jpg" )
		{
			jQuery(obj).attr("src","{$sSystemImagesAndCssPath}/highgame/images/default/icon_03.jpg");
			jQuery(obj).parent().find("ul:first").slideDown("fast");
		}else
		{
			jQuery(obj).attr("src","{$sSystemImagesAndCssPath}/highgame/images/default/icon_05.jpg");
			jQuery(obj).parent().find("ul:first").slideUp("fast");
		}
	}
	else
	{
		jQuery().ajaxStart($.blockUI).ajaxStop($.unblockUI);
		html = jQuery(obj).closest("li").html();
		jQuery(obj).ajaxStart(function(){
			jQuery(this).attr("src","{$sSystemImagesAndCssPath}/highgame/images/default/icon_03.jpg");
		});
		jQuery.ajax({
		type:			"GET",
		url:			"index.php?controller=user&action=list&frame=menu&uid="+uid,
		dataType: 		"json",
		cache:			false,
		success:		function(data){
							if( data.error == "empty" ){//没有数据
								jQuery(obj).parent().append("<ul style='display:none;'><li></li></ul>");
								jQuery(obj).attr("src","{$sSystemImagesAndCssPath}/highgame/images/default/menu_plus.gif");
							}else if( data.error == "0" ){//有数据
								dataHtml = "<ul style='float:none;'>";
								jQuery.each(data.result,function(i,n){
									dataHtml += "<li>";
									if( n.childcount > 0 )
									{
										dataHtml += "<img src=\"{$sSystemImagesAndCssPath}/highgame/images/default/icon_05.jpg\" onclick=\"getChildList(this,"+n.userid+")\" style=\"cursor:pointer;\" />";
									}else{
										dataHtml += "<img src=\"{$sSystemImagesAndCssPath}/highgame/images/default/icon_03.jpg\"  />";
									}
									dataHtml += "<a href=\"?controller=user&action=list&frame=show&uid="+n.userid+"\" target=\"userlist_content\">"+replaceHTML(n.username)+"</a> <font color='#A0A0A0'>("+n.childcount+")</font></li>";
								});
								dataHtml += "</ul>";
								jQuery(obj).parent().append(dataHtml);
							}
							else
							{
								return true;
							}
						}
		});
	}
}
</script>

<style type="text/css">
body {
	background: #585858;
}
#tabbar-div {
  background: #ca0000; padding-left: 10px; height: 27px; padding-top: 0px;}
#tabbar-div p {margin:0px;}
.tab-front { line-height: 27px; font-weight: bold; 
	cursor: hand;  cursor: pointer;color:#FFFFFF}
.tab-back,.tab-hover {color: #F4FAFB; line-height: 20px; padding: 4px 15px 4px 18px; cursor: hand; cursor: pointer;}
.tab-hover {background: #2F9DB5;}
#top-div {padding: 3px 0 2px; background: #BBDDE5; margin: 5px; text-align: center;}
#main-div {border: 1px solid #333333; padding: 5px;  background: #999999;  float:left;}
#menu-list {padding: 0; margin: 0;}
#menu-list ul {padding: 0; margin: 0; list-style-type: none; color: #335B64;}
#menu-list li {padding-left: 16px; line-height: 16px; cursor: hand; cursor: pointer;}
#main-div a:visited, #main-div a:link { color: #333333; text-decoration: none;}
#main-div a:hover { color: #000000; }
.child{
	padding-left:8px;
	border-left:double 1px #CCC;
	margin-left:3px;
}
#main-div ul{ list-style:none; margin:0; padding:0; padding-left:10px; float:left; background:#FFFFFF;}
#main-div ul li{list-style:none;line-height:20px; width:100%; text-align:left; float:left;  white-space:nowrap;}
#main-div li{ list-style:none;padding-top:2px;}
</style>
</head>
<body>

<div id="tabbar-div"><p><span class="tab-front" id="menu-tab">用户列表</span></p></div>
<div id="main-div"><ul id="child_0">
{foreach from=$users item=user key=k}
	<li id="li_{$user.userid}">
    	{if $user.childcount>0}
        <img src="{$sSystemImagesAndCssPath}/highgame/images/default/icon_05.jpg" id="img_{$user.userid}" onClick="getChildList(this,{$user.userid})" style="cursor:pointer;"> 
        {else}
        <img src="{$sSystemImagesAndCssPath}/highgame/images/default/icon_03.jpg" id="img_{$user.userid}"> 
        {/if}
        <a href="./?controller=user&action=list&frame=show&uid={$user.userid}" target="userlist_content">{$user.username|escape:html}</a> <font color='#666666'>({$user.childcount})</font>
    </li>
{foreachelse}
	<li>无下级用户</li>
{/foreach}
</ul>
</div>
</body>
</html>
