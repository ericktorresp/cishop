/* _base */
var client_uniq='';
var server_uniq='';
var last_check_msg='';
var contents_chat_panel_p1='';
var title_alert_id=-1;
var title_alert_counter=0;
function GetWaitingClients()
{
	var get_visitors='n';
	if(document.lv_visitors_update_enable)
		get_visitors='y';
	if(document.lv_adv_visitors_update_enable)
		get_visitors='ay';
	AGET({
		'parameters':{'act':'waiting_clients','mode':'list','online_status':LiveAdminConf.online_status,'gv':get_visitors},
		'anotherParameter':'true',
		'url':'index.php',
		'onSuccess':function(req){UpdateWaitingCLients(req.responseText)},
		'onError':function(req){LoopWaitingClients()}
	})
};
function LoopWaitingClients(){window.setTimeout(GetWaitingClients,3000)};function UpdateWaitingCLients(resp){var ar=ARESP(resp);if(ar['status']!=1){LoopWaitingClients();return}var sel_rows=document.WaitingClientsDataTable.getSelectedRows();var sel_client_uniq='';var should_resize=false;if(sel_rows.length>0){var sel_record=document.WaitingClientsDataTable.getRecord(sel_rows[0]);if(sel_record){sel_client_uniq=sel_record.getData('client_uniq')}}document.WaitingClientsDataTable.lv_doing_update=true;document.WaitingClientsDataTable.unselectAllRows();document.WaitingClientsDataTable.lv_doing_update=false;if(document.WaitingClientsDataTable.lv_row_count>ar['count']){for(i=document.WaitingClientsDataTable.lv_row_count-1;i>=ar['count'];i--){document.WaitingClientsDataTable.deleteRow(i);should_resize=true}}else if(document.WaitingClientsDataTable.lv_row_count<ar['count']){for(i=document.WaitingClientsDataTable.lv_row_count;i<ar['count'];i++){document.WaitingClientsDataTable.addRow({},i);should_resize=true}}if(UpdateNotes(ar))should_resize=true;UpdateControls(ar);UpdateOnlineAgents(ar,should_resize);UpdateInternChat(ar);UpdateVisitors(ar,should_resize);UpdateAdvVisitors(ar,should_resize);if(LiveAdminConf.standalone=='y'){UpdateStandAloneVersionShow(ar)}UpdateVersionCheck(ar);var i=0;var sel_i=-1;for(key in ar['list']){ar['list'][key]['client_nickname_mod']="<span class='wc_ip_flag' style='background-position: -"+ar['list'][key]['flag_x']+"px -"+ar['list'][key]['flag_y']+"px;'></span><span class='wc_nickname'>"+ar['list'][key]['client_nickname']+"</span>";document.WaitingClientsDataTable.updateRow(i,ar['list'][key]);if(LiveAdminConf.enable_callback=='yes')CheckVisitorCallback(ar['list'][key],i);if(sel_client_uniq==ar['list'][key]['client_uniq'])sel_i=i;i++;var chat_id=ar['list'][key]['client_uniq'];if(typeof document.chat_layout[chat_id]!="undefined"){var chat=document.chat_layout[chat_id];if(chat.signal_icon)chat.signal_icon.style.backgroundPosition=ar['list'][key]['client_signal']+' -30px'}}document.WaitingClientsDataTable.lv_row_count=i;if(should_resize){document.WaitingClientsDataTable.lv_resize()}if(sel_i!=-1){document.WaitingClientsDataTable.selectRow(sel_i)}if(typeof(document.WaitingClientsDataTable.get("sortedBy"))=='object'){var sortby=document.WaitingClientsDataTable.get("sortedBy");if(sortby){var sortcol=document.WaitingClientsDataTable.getColumn(sortby.key);document.WaitingClientsDataTable.sortColumn(sortcol,sortby.dir)}}if(LiveAdminConf.online_status=='yes'){if(SoundObj.ActSound(ar)){TitleAlert()}}LoopWaitingClients()};function CheckVisitorCallback(item,tb_row){var i=0;if(item['client_flag']!=7)return;for(var j in document.lv_visitors_trig){if(item['client_ip']==document.lv_visitors_trig[j]['ip']){var sel_client_uniq=item['client_uniq'];var sel_client_name=item['client_nickname'];var sel_client_flag=item['client_flag'];StartChatManual(sel_client_uniq,sel_client_name,sel_client_flag);VisitorChatWaitDialog_HIDE();delete document.lv_visitors_trig[j]}}};function CleanupVisitorCallback(){var dt=fetch_unix_timestamp();dt=dt-(10*60);for(var j in document.lv_visitors_trig){if(document.lv_visitors_trig[j]['date']<dt){delete document.lv_visitors_trig[j]}}};function UpdateStandAloneVersionShow(ar){if(typeof(ar['ver_info'])=='undefined'||typeof(ar['ver_info']['show'])=='undefined'||LiveAdminConf.standalone!='y'){return}if(DOM_GetText('lv_buttom_info_id')!=ar['ver_info']['show'])DOM_Text('lv_buttom_info_id',ar['ver_info']['show']);LiveAdminConf.trial_mode=ar['ver_info']['trial_mode']};function UpdateVersionCheck(ar){if(typeof(ar)=='undefined'||typeof(ar['lv_version'])=='undefined'){return}if(ar['lv_version']!=LiveAdminConf.lv_version){LiveAdminConf.lv_version=ar['lv_version'];var logout=function(){location.href=LiveAdminConf.logout_url+"&lv_sid="+LiveAdminConf.lv_sid+"&rnd="+Math.random()};SimpleConfirmDialog(TransLang('B100135'),TransLang('B150270'),logout,0)}};function UpdateOnlineAgents(ar,should_resize){if(LiveAdminConf.can_see_agents!='yes'||typeof(ar['online_agents'])=='undefined'||typeof(ar['online_agents_count'])=='undefined'||typeof(document.OnlineAgentsDataTable)=='undefined'){return}var dt=document.OnlineAgentsDataTable;var sel_rows=dt.getSelectedRows();var sel_userid='';if(sel_rows.length>0){var sel_record=dt.getRecord(sel_rows[0]);if(sel_record){sel_userid=sel_record.getData('agent_userid')}}dt.unselectAllRows();if(dt.lv_row_count>ar['online_agents_count']){for(i=dt.lv_row_count-1;i>=ar['online_agents_count'];i--){dt.deleteRow(i);should_resize=true}}else if(dt.lv_row_count<ar['online_agents_count']){for(i=dt.lv_row_count;i<ar['online_agents_count'];i++){dt.addRow({},i);should_resize=true}}var i=0;var sel_i=-1;for(key in ar['online_agents']){var trec={'agent_userid':ar['online_agents'][key][0],'agent_nickname':ar['online_agents'][key][1],'agent_access_level':ar['online_agents'][key][2],'agent_is_self':ar['online_agents'][key][3],'agent_is_online':ar['online_agents'][key][4],'agent_status':ar['online_agents'][key][5],'agent_nickname_mod':'<span class="og_icon og_icon_'+ar['online_agents'][key][6]+'"></span><span class="og_name">'+ar['online_agents'][key][1]+'</span>'};dt.updateRow(i,trec);if(sel_userid==trec['agent_userid'])sel_i=i;i++}dt.lv_row_count=i;if(should_resize)dt.lv_resize();if(sel_i!=-1){dt.selectRow(sel_i)}};function UpdateVisitors(ar,should_resize){if(document.lv_visitors_update_enable==false){if(should_resize&&typeof(document.VisitorsDataTable)!='undefined')document.VisitorsDataTable.lv_resize();return}if(LiveAdminConf.can_see_visitors!='yes'||typeof(ar['visitors'])=='undefined'||typeof(ar['visitors_count'])=='undefined'||typeof(document.VisitorsDataTable)=='undefined')return;var dt=document.VisitorsDataTable;var sel_rows=dt.getSelectedRows();var sel_ip='';if(sel_rows.length>0){var sel_record=dt.getRecord(sel_rows[0]);if(sel_record){sel_ip=sel_record.getData('visitor_ip')}}dt.unselectAllRows();if(dt.lv_row_count>ar['visitors_count']){for(i=dt.lv_row_count-1;i>=ar['visitors_count'];i--){dt.deleteRow(i);should_resize=true}}else if(dt.lv_row_count<ar['visitors_count']){for(i=dt.lv_row_count;i<ar['visitors_count'];i++){dt.addRow({},i);should_resize=true}}var i=0;var sel_i=-1;for(key in ar['visitors']){var trec={'visitor_ip':ar['visitors'][key][0],'visitor_page':ar['visitors'][key][1],'visitor_flag_x':ar['visitors'][key][2],'visitor_flag_y':ar['visitors'][key][3],'visitor_active':ar['visitors'][key][4]};trec['visitor_loc']="<span class='wc_ip_flag' style='background-position: -"+trec['visitor_flag_x']+"px -"+trec['visitor_flag_y']+"px;'></span><span class='wc_nickname'>"+trec['visitor_ip']+"</span>";dt.updateRow(i,trec);if(sel_ip==trec['visitor_ip'])sel_i=i;i++}dt.lv_row_count=i;if(should_resize)dt.lv_resize();if(sel_i!=-1){dt.selectRow(sel_i)}};function UpdateAdvVisitors(ar,should_resize){if(document.lv_adv_visitors_update_enable==false)return;if(LiveAdminConf.can_see_visitors!='yes'||typeof(ar['visitors'])=='undefined'||typeof(ar['visitors_count'])=='undefined'||typeof(ar['visitors_type'])=='undefined'||ar['visitors_type']!='ay'||typeof(document.visitors_layout.AdvVisitorsDataTable)=='undefined')return;var dt=document.visitors_layout.AdvVisitorsDataTable;var sel_rows=dt.getSelectedRows();var sel_ip='';if(sel_rows.length>0){var sel_record=dt.getRecord(sel_rows[0]);if(sel_record){sel_ip=sel_record.getData('ip')}}dt.unselectAllRows();if(dt.lv_row_count>ar['visitors_count']){for(i=dt.lv_row_count-1;i>=ar['visitors_count'];i--){dt.deleteRow(i);should_resize=true}}else if(dt.lv_row_count<ar['visitors_count']){for(i=dt.lv_row_count;i<ar['visitors_count'];i++){dt.addRow({},i);should_resize=true}}var i=0;var sel_i=-1;var arvs=[];var arvs_count=0;for(key in ar['visitors']){if(typeof(ar['visitors'][key][9])!='undefined'){var trec={'ip':ar['visitors'][key][0],'page':ar['visitors'][key][1],'flag_x':ar['visitors'][key][2],'flag_y':ar['visitors'][key][3],'active':ar['visitors'][key][4],'country':ar['visitors'][key][5],'browser':ar['visitors'][key][6],'ip_x':ar['visitors'][key][7],'ip_y':ar['visitors'][key][8],'page_full':ar['visitors'][key][9]};trec['location']="<span class='wc_ip_flag' style='background-position: -"+trec['flag_x']+"px -"+trec['flag_y']+"px;'></span><span class='wc_nickname'>"+trec['country']+"</span>";trec['page']=trec['page_full'];dt.updateRow(i,trec);if(sel_ip==trec['ip'])sel_i=i;arvs[key]=trec;arvs_count++;i++}}document.visitors_layout.lv_update_markers(arvs,arvs_count);dt.lv_row_count=i;if(should_resize)dt.lv_resize();if(sel_i!=-1){dt.selectRow(sel_i)}};function UpdateInternChat(ar){if(LiveAdminConf.can_see_agents!='yes'||typeof(ar['msg_intern'])=='undefined'||typeof(ar['msg_intern_count'])=='undefined'||ar['msg_intern_count']*1==0)return;for(key in ar['msg_intern']){var dlg=StartInternChat(ar['msg_intern'][key]['sender_userid'],ar['msg_intern'][key]['sender_nickname']);var data={time:"<strong>"+ar['msg_intern'][key]['dtt']+"</strong>",message:"<strong>"+ar['msg_intern'][key]['message']+"</strong>"};dlg.lv.AddMessageToView(data)}};function UpdateNotes(ar){var ret=false;if(typeof(ar['notes'])=='undefined'||typeof(ar['notes_count'])=='undefined'||ar['notes_count']*1==0||typeof(document.lv_notes.innerHTML)=='undefined'){if(DOM_IsHide('notes_id')!=1){ret=true}DOM_Hide('notes_id');return(ret)}var pr=document.lv_notes.innerHTML;var ne='';ne='';for(key in ar['notes']){ne+='<div>'+ar['notes'][key]+'</div>'}if(document.lv_notes.innerHTML!=ne){document.lv_notes.innerHTML=ne;ret=true}DOM_Show('notes_id');return(ret)};function UpdateControls(ar){if(typeof(ar['can_online'])=='undefined'){return}if(ar['can_online']=='yes'){document.OnlineButton.set('disabled',false)}else{document.OnlineButton.set('disabled',true);document.OnlineButton.set('label',TransLang('B100750'))}};function TitleAlert(){if(document.title){if(title_alert_id!=-1){window.clearTimeout(title_alert_id);title_alert_id=-1}title_alert_counter=0;title_alert_id=window.setTimeout(TitleAlertTimeout,100)}};function TitleAlertTimeout(){if(title_alert_counter%2==0){document.title="(  @) Live Admin"}else{document.title="(@  ) Live Admin"}title_alert_counter++;if(title_alert_counter>15){title_alert_counter=0;document.title="Live Admin"}else{title_alert_id=window.setTimeout(TitleAlertTimeout,100+(title_alert_counter*2))}};function LogoutPress(){var logout=function(){location.href=LiveAdminConf.logout_url+"&lv_sid="+LiveAdminConf.lv_sid+"&rnd="+Math.random()};SimpleConfirmDialog(TransLang('B100135'),TransLang('B150220'),logout,0)};function dialog_strings_click(id){if(typeof(document.getElementById(id+"_cb_id"))=='undefined')return;if(document.getElementById(id+"_cb_id").checked)DOM_Disable(id+"_text_id");else DOM_Enable(id+"_text_id")};function ArchiveMissedCall(client_uniq){AGET({'parameters':{'act':'archive_missed_call','client_uniq':client_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})};function DeleteMissedCall(client_uniq){if(confirm(TransLang('B150190'))){AGET({'parameters':{'act':'delete_missed_call','client_uniq':client_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})}};function StartVisitorChat(visitor_ip){VisitorChatWaitDialog_SHOW();AGET({'parameters':{'act':'start_visitor_chat','ip':visitor_ip},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}});var cs=fetch_unix_timestamp()+":"+Math.random()+":"+Math.random();document.lv_visitors_trig[cs]={'ip':visitor_ip,'date':fetch_unix_timestamp()}};function StartChat(){if(document.AnswerButton.get('disabled'))return;var sel_rows=document.WaitingClientsDataTable.getSelectedRows();if(sel_rows.length>0){var sel_client_uniq='';var sel_client_name='';var sel_client_flag=0;var sel_record=document.WaitingClientsDataTable.getRecord(sel_rows[0]);if(sel_record){sel_client_uniq=sel_record.getData('client_uniq');sel_client_name=sel_record.getData('client_nickname');sel_client_flag=sel_record.getData('client_flag')}StartChatManual(sel_client_uniq,sel_client_name,sel_client_flag)}};function StartChatManual(sel_client_uniq,sel_client_name,sel_client_flag){sel_client_flag=sel_client_flag*1;if(sel_client_uniq=='')return;if(sel_client_name=='')sel_client_name='Chat';if(typeof(document.tabViewTabs)!='undefined'&&document.tabViewTabs[sel_client_uniq]){if(document.chat_layout[sel_client_uniq]&&document.chat_layout[sel_client_uniq].is_closed){CloseChatTab(sel_client_uniq)}else{document.tabView.set('activeIndex',document.tabView.getTabIndex(document.tabViewTabs[sel_client_uniq]));return}}var cnt='<div id="chat_layout_'+sel_client_uniq+'"></div>';var cnt_buttom=contents_chat_panel_p1;cnt_buttom=cnt_buttom.replace(/-chat_id-/g,sel_client_uniq);chat_lable='<span id="lv_chat_tab_title_id_'+sel_client_uniq+'" class="lv_chat_tab_title">'+sel_client_name+'</span><span id="chat_layout_close_'+sel_client_uniq+'" class="lv_chat_tab_close"></span>';var tab=new YAHOO.widget.Tab({label:chat_lable,content:cnt,active:true});tab.sel_client_uniq=sel_client_uniq;document.tabView.addTab(tab);tab.lv_blick_able=true;tab.lv_blink=function(){tab.get('labelEl').parentNode.className='lv_tab_blink'};tab.lv_unblink=function(){tab.get('labelEl').parentNode.className=''};document.tabView.set('activeIndex',document.tabView.getTabIndex(tab));document.tabViewTabs[sel_client_uniq]=tab;var chat_layout=new YAHOO.widget.Layout('chat_layout_'+sel_client_uniq,{height:document.layout.getSizes().center.h-49,parent:document.layout,units:[{position:'top',body:'',height:34,gutter:'5px 5px 0px 5px',minHeight:34},{position:'bottom',height:170,minHeight:170,resize:true,gutter:'5px 5px 5px 5px',body:cnt_buttom},{position:'center',body:'<div class="lv_chat_div"><div id="chat_screen_'+sel_client_uniq+'"></div></div> <div class="chat_panel_p1_ac" id="chat_panel_p1_ac_id_'+sel_client_uniq+'"></div> ',gutter:'5px 5px 0px 5px'}]});tab.lvb_layout=chat_layout;chat_layout.sel_client_uniq=sel_client_uniq;chat_layout.addListener('resize',function(){nav_el=YAHOO.util.Dom.getElementsByClassName('yui-nav','ul','lv_tabs');chat_layout.set('height',document.layout.getSizes().center.h-nav_el[0].clientHeight-18);YAHOO.util.Dom.get("text_id_"+this.sel_client_uniq).style.height=(this.getSizes().bottom.h-60)+'px';document.chat_DataTable_array[this.sel_client_uniq].lv_resize()});chat_layout.is_closed=false;document.chat_layout[sel_client_uniq]=chat_layout;chat_layout.render();chat_layout.getUnitByPosition('top').addClass('lv_chat_top1_cls');chat_layout.getUnitByPosition('bottom').addClass('lv_chat_bottom1_cls');chat_layout.getUnitByPosition('center').addClass('lv_chat_center1_cls');chat_layout.getUnitByPosition('top').lv_anim_expand=null;chat_layout.getUnitByPosition('top').lv_anim_collapse=null;YAHOO.util.Dom.get("text_id_"+sel_client_uniq).focus();AutoCmpData=new YAHOO.util.XHRDataSource("index.php");AutoCmpData.responseType=YAHOO.util.XHRDataSource.TYPE_TEXT;AutoCmpData.responseSchema={recordDelim:"\n",fieldDelim:"|--_--|"};AutoCmpData.maxCacheEntries=5;AutoCmpData.lv_clear_cache=function(){this.flushCache()};AutoCmp=new YAHOO.widget.AutoComplete("text_id_"+sel_client_uniq,'chat_panel_p1_ac_id_'+sel_client_uniq,AutoCmpData);AutoCmp.allowBrowserAutocomplete=false;AutoCmp.maxResultsDisplayed=100;AutoCmp.typeAhead=true;AutoCmp.typeAheadDelay=2;AutoCmp.autoHighlight=false;AutoCmp.animVert=false;AutoCmp.animanimHoriz=false;AutoCmp.lv_selected=null;AutoCmp.lv_data=AutoCmpData;AutoCmp.lv_sec=sel_client_uniq;DOM_Hide("chat_panel_p1_ac_id_"+sel_client_uniq);AutoCmp.lv_enable=function(){this.minQueryLength=1};AutoCmp.lv_disable=function(){this.minQueryLength=-1};AutoCmp.lv_is_enabled=function(){if(this.minQueryLength==-1)return false;return true};AutoCmp.containerCollapseEvent.subscribe(function(sType,aArgs){oSelf=aArgs[0];DOM_Hide("chat_panel_p1_ac_id_"+oSelf.lv_sec)});AutoCmp.containerExpandEvent.subscribe(function(sType,aArgs){oSelf=aArgs[0];DOM_Show("chat_panel_p1_ac_id_"+oSelf.lv_sec)});AutoCmp.doBeforeExpandContainer=function(elTextbox,elContainer,sQuery,aResults){if(this.lv_is_enabled())return true;return false};AutoCmp.textboxKeyEvent.subscribe(function(sType,aArgs){oSelf=aArgs[0];nKeycode=aArgs[1];if(nKeycode==46&&oSelf.isContainerOpen()&&oSelf.lv_selected!=null&&oSelf.lv_selected.innerHTML!=''){AGET({'parameters':{'act':'delete_history','query_md5':hex_md5(oSelf.lv_selected.innerHTML)},'anotherParameter':'true','url':'index.php','onSuccess':function(req){oSelf.lv_data.lv_clear_cache()},'onError':function(req){}})}});AutoCmp.itemArrowFromEvent.subscribe(function(sType,aArgs){oSelf=aArgs[0];elItem=aArgs[1];oSelf.lv_selected=null});AutoCmp.itemArrowToEvent.subscribe(function(sType,aArgs){oSelf=aArgs[0];elItem=aArgs[1];oSelf.lv_selected=elItem});AutoCmp.generateRequest=function(sQuery){return('?act=auto_complete&query_enc='+Base64.liveadmin_encode(sQuery)+'&lv_sid='+LiveAdminConf.lv_sid+'&rnd='+Math.random())};document.chat_layout[sel_client_uniq].auto_complete_data=AutoCmpData;document.chat_layout[sel_client_uniq].auto_complete=AutoCmp;var SendButton=new YAHOO.widget.Button("chat_panel_p1_button_id_"+sel_client_uniq);SendButton.addListener("click",function(ev,sec){SendText(sec);RefreshSendBtn(sec);return(false)},sel_client_uniq);SendButton.set('disabled',true);chat_layout.SendButton=SendButton;var OnholdButton=new YAHOO.widget.Button("chat_panel_p1_onhold_id_"+sel_client_uniq);OnholdButton.addListener("click",function(ev,sec){OnholdPress(sec)},sel_client_uniq);OnholdButton.lv_state='';if(sel_client_flag==6){OnholdButton.set('label',TransLang('B100470'));OnholdButton.lv_state='resume';document.getElementById("text_id_"+sel_client_uniq).disabled=true}else{OnholdButton.set('label',TransLang('B100480'));OnholdButton.lv_state='onhold';document.getElementById("text_id_"+sel_client_uniq).disabled=false}var DraftButton=new YAHOO.widget.Button("chat_panel_p1_draft_id_"+sel_client_uniq);DraftButton.addListener("click",function(ev,sec){DraftPress(sec)},sel_client_uniq);DraftButton.set('label',TransLang('B101770'));DraftButton.lv_save_draft=false;chat_layout.DraftButton=DraftButton;var TransferButton=new YAHOO.widget.Button("chat_panel_p1_transfer_id_"+sel_client_uniq);TransferButton.addListener("click",function(ev,sec){TransferPress(sec)},sel_client_uniq);TransferButton.set('label',TransLang('B102310'));chat_layout.TransferButton=TransferButton;var CloseButton=new YAHOO.widget.Button("chat_panel_p1_close_id_"+sel_client_uniq);CloseButton.addListener("click",function(ev,sec){ClosePress(sec)},sel_client_uniq);chat_layout.OnholdButton=OnholdButton;var close_btn_el=YAHOO.util.Dom.get("chat_layout_close_"+sel_client_uniq);close_btn_el.tab=tab;YAHOO.util.Event.addListener(close_btn_el,"click",function(ev,sec){YAHOO.util.Event.stopEvent(ev);CloseChatTab(sec)},sel_client_uniq);var ChatPanelColumnDefs=[{key:"dir",label:" "},{key:"time",label:TransLang('B100490')},{key:"text",label:TransLang('B100500')}];var ChatPanelDataSource=new YAHOO.util.DataSource([]);ChatPanelDataSource.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;ChatPanelDataSource.responseSchema={fields:["dir","time","text"]};var chat_DataTable=new YAHOO.widget.DataTable('chat_screen_'+sel_client_uniq,ChatPanelColumnDefs,ChatPanelDataSource,{selectionMode:"single",scrollable:true,height:(chat_layout.getSizes().center.h-32)+'px',width:"100%",MSG_EMPTY:""});chat_DataTable.sel_client_uniq=sel_client_uniq;chat_DataTable.subscribe("rowMouseoverEvent",chat_DataTable.onEventHighlightRow);chat_DataTable.subscribe("rowMouseoutEvent",chat_DataTable.onEventUnhighlightRow);chat_DataTable.subscribe("rowClickEvent",chat_DataTable.onEventSelectRow);chat_DataTable.lv_resize=function(){chat_lay=document.chat_layout[this.sel_client_uniq];this.set('height',(chat_lay.getSizes().center.h-32)+'px');clm=this.getColumn('dir');this.setColumnWidth(clm,15);clm=this.getColumn('time');this.setColumnWidth(clm,60);clm=this.getColumn('text');sc_width=this.getBdContainerEl().offsetWidth-this.getBdContainerEl().clientWidth;this.setColumnWidth(clm,(chat_lay.getSizes().center.w-80-60-10-sc_width))};document.chat_DataTable_array[sel_client_uniq]=chat_DataTable;chat_layout.sel_datatable=chat_DataTable;chat_layout.sel_datatable_rec_count=0;chat_layout.resize();var text_area_el=YAHOO.util.Dom.get("text_id_"+sel_client_uniq);YAHOO.util.Event.addListener(text_area_el,"keydown",function(ev,sec){if(!ev.shiftKey&&!ev.ctrlKey&&!ev.altKey){if(ev.keyCode==13){YAHOO.util.Event.stopEvent(ev);if(document.chat_layout[sec].auto_complete&&document.chat_layout[sec].auto_complete.isContainerOpen()){document.chat_layout[sec].auto_complete.collapseContainer()}else{SendText(sec)}return true}if(ev.keyCode==27){if(document.chat_layout[sec].auto_complete)document.chat_layout[sec].auto_complete.lv_disable();return true}if(ev.keyCode==8){if(document.chat_layout[sec].auto_complete)document.chat_layout[sec].auto_complete.lv_enable();return true}if(ev.keyCode==9){YAHOO.util.Event.stopEvent(ev);YAHOO.util.Dom.get("text_id_"+sec).focus();return true}if(ev.keyCode==46){if(document.chat_layout[sec].auto_complete&&document.chat_layout[sec].auto_complete.isContainerOpen()){YAHOO.util.Event.stopEvent(ev);return true}}}},sel_client_uniq);YAHOO.util.Event.addListener(text_area_el,"keyup",function(ev,sec){RefreshSendBtn(sec);return false},sel_client_uniq);AGET({'parameters':{'act':'start_chat',client:sel_client_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){StartChatProcess(req.responseText)},'onError':function(req){alert(TransLang('B100120')+'\n'+TransLang('B100160'))}})};function CloseChatTab(sec){document.tabView.removeTab(document.tabViewTabs[sec]);delete document.tabViewTabs[sec];delete document.chat_layout[sec];delete document.chat_DataTable_array[sec]};function StartChatProcess(resp){var ar=ARESP(resp);if(ar['status']!=1&&ar['status']!=2){return}var client_uniq_r=ar['client_uniq'];if(!document.chat_layout[client_uniq_r])return;var chat=document.chat_layout[client_uniq_r];chat.lv_view_only=false;if(ar['status']==2){chat.lv_view_only=true;chat.getUnitByPosition('bottom').close();chat.is_closed=true;var tab_title=DOM_Get('lv_chat_tab_title_id_'+client_uniq_r);tab_title.innerHTML+=' ('+TransLang('B100840')+')'}chat.sel_server_uniq=ar['server_uniq'];chat.last_check_msg='';chat.sel_datatable.anim=new YAHOO.util.Scroll(chat.sel_datatable.getBdContainerEl(),{scroll:{to:[0,999999]}});if(typeof(ar['client_ip_extra'])=='undefined')ar['client_ip_extra']='';else ar['client_ip_extra']=', '+ar['client_ip_extra'];var chat_top_pos=chat.getUnitByPosition('top');chat_top_pos.addClass('lv_chat_position_top');top_position_html='<span id="lv_network_icon_id_'+chat.sel_client_uniq+'" class="lv_network_icon lv_icons"></span>';top_position_html+='<span id="lv_signal_icon_id_'+chat.sel_client_uniq+'" class="lv_signal_icon lv_icons"></span>';top_position_html+='<span id="lv_type_icon_id_'+chat.sel_client_uniq+'" class="lv_type_icon lv_icons"></span>';top_position_html+='<span id="lv_info_icon_id_'+chat.sel_client_uniq+'" class="lv_info_icon lv_icons"></span>';top_position_html+='<span id="lv_block_icon_id_'+chat.sel_client_uniq+'" class="lv_block_icon lv_icons"></span>';top_position_html+='<div class="lv_chat_position_top_div" id="lv_chat_position_top_div_id">';top_position_html+='<span id="lv_chat_top_ip_id_'+chat.sel_client_uniq+'"><strong>'+TransLang('B100510')+': </strong><em>'+ar['client_ip']+' '+ar['client_ip_extra']+'</em></span>';var f_count=1;for(key in ar['client_info']){if(key.substr(0,1)!='_'){if(key=='lv_department_res'){top_position_html+='<span><strong>'+TransLang('B102180')+': </strong><em>'+ar['client_info'][key]+'</em></span>'}else{top_position_html+='<span><strong>'+key+': </strong><em>'+ar['client_info'][key]+'</em></span>'}f_count++}}top_position_html+='</div>';chat_top_pos.body.innerHTML=top_position_html;var fld=YAHOO.util.Dom.get("lv_chat_top_ip_id_"+chat.sel_client_uniq);chat_top_pos.lv_expand_height=((fld.offsetHeight+fld.style.paddingTop+fld.style.paddingBottom)*f_count)+20;chat_top_pos.lv_collapse_height=35;if(chat_top_pos.lv_anim_expand==null){chat_top_pos.lv_anim_expand=new YAHOO.util.Anim(chat_top_pos.get('element'),{height:{to:chat_top_pos.lv_expand_height}},0.1,YAHOO.util.Easing.easeOut);chat_top_pos.lv_anim_expand.lv_ctp=chat.sel_client_uniq;chat_top_pos.lv_anim_expand.lv_ctpo=null;chat_top_pos.lv_anim_expand.onComplete.subscribe(function(){if(this.lv_ctpo==null)return});chat_top_pos.lv_anim_expand.onTween.subscribe(function(){if(this.lv_ctpo)this.lv_ctpo.set('height',this.getAttribute('height'))});chat_top_pos.lv_anim_expand.onStart.subscribe(function(){if(this.lv_ctpo==null){if(typeof(document.chat_layout[this.lv_ctp])=='undefined')return;var chat=document.chat_layout[this.lv_ctp];this.lv_ctpo=chat.getUnitByPosition('top')}})}if(chat_top_pos.lv_anim_collapse==null){chat_top_pos.lv_anim_collapse=new YAHOO.util.Anim(chat_top_pos.get('element'),{height:{to:chat_top_pos.lv_collapse_height}},0.1,YAHOO.util.Easing.easeOut);chat_top_pos.lv_anim_collapse.lv_ctp=chat.sel_client_uniq;chat_top_pos.lv_anim_collapse.lv_ctpo=null;chat_top_pos.lv_anim_collapse.onComplete.subscribe(function(){if(this.lv_ctpo==null)return});chat_top_pos.lv_anim_collapse.onTween.subscribe(function(){if(this.lv_ctpo)this.lv_ctpo.set('height',this.getAttribute('height'))});chat_top_pos.lv_anim_collapse.onStart.subscribe(function(){if(this.lv_ctpo==null){if(typeof(document.chat_layout[this.lv_ctp])=='undefined')return;var chat=document.chat_layout[this.lv_ctp];this.lv_ctpo=chat.getUnitByPosition('top')}})}chat_top_pos.lv_collapse=true;chat.lv_set_status_bar=function(s){DOM_Text('chat_panel_p1_status_bar_id_'+this.sel_client_uniq,s)};chat.network_icon=YAHOO.util.Dom.get("lv_network_icon_id_"+chat.sel_client_uniq);chat.network_icon.style.backgroundPosition='0px 0px';chat.signal_icon=YAHOO.util.Dom.get("lv_signal_icon_id_"+chat.sel_client_uniq);chat.signal_icon.style.backgroundPosition='-150px -30px';chat.type_icon=YAHOO.util.Dom.get("lv_type_icon_id_"+chat.sel_client_uniq);chat.type_icon.style.backgroundPosition='-120px 0px';chat.info_icon=YAHOO.util.Dom.get("lv_info_icon_id_"+chat.sel_client_uniq);chat.info_icon.style.backgroundPosition='0px -60px';chat.block_icon=YAHOO.util.Dom.get("lv_block_icon_id_"+chat.sel_client_uniq);chat.block_icon.style.backgroundPosition='-180px -30px';if(chat.lv_view_only){chat.block_icon.style.display='none'}YAHOO.util.Event.addListener(chat.info_icon,"click",function(ev,sec){if(typeof(document.chat_layout[sec])=='undefined')return;var chat=document.chat_layout[sec];chat_top_pos=chat.getUnitByPosition('top');if(chat_top_pos.lv_collapse){chat_top_pos.lv_collapse=false;chat.info_icon.style.backgroundPosition='-70px -60px';chat_top_pos.lv_anim_expand.animate()}else{chat_top_pos.lv_collapse=true;chat.info_icon.style.backgroundPosition='0px -60px';chat_top_pos.lv_anim_collapse.animate()}},chat.sel_client_uniq);YAHOO.util.Event.addListener(chat.block_icon,"click",function(ev,sec){if(typeof(document.chat_layout[sec])=='undefined')return;if(DemoMode())return;if(TrialMode())return;var chat=document.chat_layout[sec];ConfigAdminSide('dialog_confirm_block_access',{'client_uniq':chat.sel_client_uniq,'server_uniq':chat.sel_server_uniq})},chat.sel_client_uniq);chat.MessageLoop=function(){if(typeof(document.chat_layout[chat.sel_client_uniq])=='undefined')return;chat.network_icon.style.backgroundPosition='-30px 0px';AGET({'parameters':{'act':'message_loop','client_uniq':chat.sel_client_uniq,'server_uniq':chat.sel_server_uniq,'last_check':chat.last_check_msg},'anotherParameter':'true','url':'index.php','onSuccess':function(req){chat.UpdateMessages(req.responseText)},'onError':function(req){chat.setMessageLoop()}})};chat.UpdateMessages=function(resp){if(typeof(document.chat_layout[this.sel_client_uniq])=='undefined')return;chat.network_icon.style.backgroundPosition='-60px 0px';window.setTimeout(function(){chat.network_icon.style.backgroundPosition='0px 0px'},200);var ar=ARESP(resp);if(ar['status']==0){this.setMessageLoop();return}if(ar['status']==1){this.last_check_msg=ar['last_check'];if(ar['msg_count']>0){for(var key in ar['msgs']){this.AddMessageToView(ar['msgs'][key])}}if(chat.lv_view_only==false){SoundObj.ActSound(ar)}}this.setMessageLoop()};chat.setMessageLoop=function(){if(typeof(document.chat_layout[this.sel_client_uniq])=='undefined')return;window.setTimeout(document.chat_layout[this.sel_client_uniq].MessageLoop,3000)};chat.AddMessageToView=function(msg_ar){if(typeof(document.chat_layout[this.sel_client_uniq])=='undefined')return;msg=msg_ar['msg'];if(msg_ar['dir']=='ctl'){this.ProcessControlMessage(msg)}else{if(msg_ar['dir']==1||msg_ar['dir']==2){msg=Base64.liveadmin_decode(msg)}msg=msg.replace(/\n/g,'<br>');dirmg='<img src="images/'+msg_ar['dir']+'.png" />';if(msg_ar['dir']=='svc')msg='<em class="lv_svc_message">'+msg+'</em>';var data={time:msg_ar['time'],text:msg,dir:dirmg};this.sel_datatable.addRow(data);this.sel_datatable_rec_count++;this.sel_datatable.anim.animate();this.sel_datatable.lv_resize();if(chat.lv_view_only==false){if(document.tabView.get('activeIndex')!=document.tabView.getTabIndex(document.tabViewTabs[this.sel_client_uniq])){document.tabViewTabs[this.sel_client_uniq].lv_blink()}}}};chat.ProcessControlMessage=function(m){switch(m){case LiveAdminConf.CTL_CLIENT_TYPE_ON:if(typeof(this.type_icon)!='undefined')this.type_icon.style.backgroundPosition='-90px -0px';this.lv_set_status_bar(TransLang('B100520'));break;case LiveAdminConf.CTL_CLIENT_TYPE_OFF:if(typeof(this.type_icon)!='undefined')this.type_icon.style.backgroundPosition='-120px -0px';this.lv_set_status_bar('');break;case LiveAdminConf.CTL_CHAT_CLOSED_BY_CLIENT:case LiveAdminConf.CTL_CHAT_CLOSED_BY_ADMIN:this.getUnitByPosition('bottom').close();this.block_icon.style.display='none';this.is_closed=true;break}};chat.MessageLoop()};function SendControlMessage(msg,chat_id){if(!document.chat_layout[chat_id])return;var chat=document.chat_layout[chat_id];AGET({'parameters':{'act':'control','message':msg,client_uniq:chat.sel_client_uniq,server_uniq:chat.sel_server_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})};function DiscardChat(){var sel_rows=document.WaitingClientsDataTable.getSelectedRows();var sel_client_uniq='';if(sel_rows.length>0){var sel_record=document.WaitingClientsDataTable.getRecord(sel_rows[0]);if(sel_record){sel_client_uniq=sel_record.getData('client_uniq')}}if(sel_client_uniq=='')return;document.DiscardButton.set('disabled',true);AGET({'parameters':{'act':'discard_chat',client_uniq:sel_client_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})};function ResetList(list){if(list.length){list.length=0}};function Initialize(){MessageLoop()};function AddMessageToView(s){document.getElementById('message_id').innerHTML+=s;document.getElementById('message_id').scrollIntoView()};function Send(s,c_uniq,s_uniq){if(s.length==0)return;AGET({'parameters':{'act':'message','message':s,'client_uniq':c_uniq,'server_uniq':s_uniq},'anotherParameter':'true','url':'index.php','method':'post','onSuccess':function(req){},'onError':function(req){}})};function SendText(chat_id){if(!document.chat_layout[chat_id])return false;var chat=document.chat_layout[chat_id];if(chat.auto_complete){chat.auto_complete.lv_enable();chat.auto_complete_data.lv_clear_cache()}var text=document.getElementById("text_id_"+chat_id).value;document.getElementById("text_id_"+chat_id).value='';if(LiveAdminConf.trial_mode=="yes"){if(chat.sel_datatable_rec_count>=20){SimpleDialog(TransLang('B100130'),TransLang('B100468'));return false}}Send(text,chat.sel_client_uniq,chat.sel_server_uniq);return false};function RefreshSendBtn(sec){if(!document.chat_layout[sec])return false;var chat=document.chat_layout[sec];var text=document.getElementById("text_id_"+sec).value;if(text&&text.length>0){if(chat.SendButton.get('disabled')){chat.SendButton.set('disabled',false);SendControlMessage(LiveAdminConf.CTL_ADMIN_TYPE_ON,sec)}if(document.chat_layout[sec].auto_complete)document.chat_layout[sec].auto_complete.lv_enable();if(!chat.DraftButton.lv_save_draft){chat.DraftButton.set('label',TransLang('B101760'));chat.DraftButton.lv_save_draft=true}}else{if(!chat.SendButton.get('disabled')){chat.SendButton.set('disabled',true);SendControlMessage(LiveAdminConf.CTL_ADMIN_TYPE_OFF,sec)}if(document.chat_layout[sec].auto_complete)document.chat_layout[sec].auto_complete.lv_disable();if(chat.DraftButton.lv_save_draft){chat.DraftButton.set('label',TransLang('B101770'));chat.DraftButton.lv_save_draft=false}}};function OnholdPress(chat_id){if(!document.chat_layout[chat_id])return;var chat=document.chat_layout[chat_id];var act='';if(chat.OnholdButton.lv_state=='onhold'){chat.OnholdButton.set('label','Resume');chat.OnholdButton.lv_state='resume';act='onhold_chat';document.getElementById("text_id_"+chat_id).disabled=true}else{chat.OnholdButton.set('label','On Hold');chat.OnholdButton.lv_state='onhold';act='resume_chat';document.getElementById("text_id_"+chat_id).disabled=false}AGET({'parameters':{'act':act,client_uniq:chat.sel_client_uniq,server_uniq:chat.sel_server_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}});return false};function DraftPress(chat_id){if(!document.chat_layout[chat_id])return;var chat=document.chat_layout[chat_id];if(chat.DraftButton.lv_save_draft){var text=document.getElementById("text_id_"+chat_id).value;if(text&&text.length>0){AGET({'parameters':{'act':'add_draft','message':text},'anotherParameter':'true','url':'index.php','method':'post','onSuccess':function(req){},'onError':function(req){}})}}else{DialogDraft(chat_id)}};function ClosePress(chat_id){if(!document.chat_layout[chat_id])return;var chat=document.chat_layout[chat_id];AGET({'parameters':{'act':'close_chat',client_uniq:chat.sel_client_uniq,server_uniq:chat.sel_server_uniq},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})};function OnlinePress(){if(document.OnlineButton.get('checked')){LiveAdminConf.online_status='yes';document.OnlineButton.set('label',TransLang('B100740'))}else{LiveAdminConf.online_status='no';document.OnlineButton.set('label',TransLang('B100750'));AGET({'parameters':{'act':'make_offline'},'anotherParameter':'true','url':'index.php','onSuccess':function(req){},'onError':function(req){}})}};YAHOO.util.Event.addListener(window,"load",function(){YAHOO.example.RowSelection=function(){}()});function UpdateWaitingClientsInfoBar(infobar_text){if(document.WaitingClientsInfoBarResizeBusy==0){DOM_Text('waiting_clients_infobar_text_id',infobar_text)}document.WaitingClientsInfoBarResizeCnt=infobar_text;if(typeof(document.WaitingClientsInfoBarResize)=='undefined'){var max_h=200;document.WaitingClientsInfoBarResize=new YAHOO.util.Resize(document.WaitingClientsInfoBar,{handles:['t'],minHeight:60,maxHeight:max_h});document.WaitingClientsInfoBarResize.on('resize',function(args){document.WaitingClientsDataTable.lv_resize()},document.WaitingClientsDataTable,true);document.WaitingClientsInfoBarResize.on('startResize',function(args){document.WaitingClientsInfoBarResizeBusy=1},document.WaitingClientsDataTable,true);document.WaitingClientsInfoBarResize.on('endResize',function(args){document.WaitingClientsInfoBarResizeBusy=0;UpdateWaitingClientsInfoBar(document.WaitingClientsInfoBarResizeCnt);document.WaitingClientsDataTable.lv_resize()},document.WaitingClientsDataTable,true)}};function InitGlobalLists(){var WaitingClientsColumnDefs=[{key:"client_nickname_mod",sortable:true,label:TransLang('B100530')},{key:"assign_to",sortable:true,label:TransLang('B100540')}];var WaitingClientsDataSource=new YAHOO.util.DataSource([]);WaitingClientsDataSource.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;WaitingClientsDataSource.responseSchema={fields:["client_nickname_mod","assign_to"]};var WaitingClientsDataTable=new YAHOO.widget.DataTable("waiting_clients_list",WaitingClientsColumnDefs,WaitingClientsDataSource,{selectionMode:"single",scrollable:true,height:"20em",width:"100%",MSG_EMPTY:TransLang('B100550')});WaitingClientsDataTable.lv_row_count=0;document.WaitingClientsDataTable=WaitingClientsDataTable;document.WaitingClientsDataTable.lv_doing_update=false;WaitingClientsDataTable.subscribe("rowMouseoverEvent",WaitingClientsDataTable.onEventHighlightRow);WaitingClientsDataTable.subscribe("rowMouseoutEvent",WaitingClientsDataTable.onEventUnhighlightRow);WaitingClientsDataTable.subscribe("rowClickEvent",WaitingClientsDataTable.onEventSelectRow);WaitingClientsDataTable.subscribe("rowDblclickEvent",StartChat);document.WaitingClientsInfoBar=DOM_Get('waiting_clients_infobar_id');document.WaitingClientsInfoBarResizeBusy=0;document.WaitingClientsInfoBarResizeCnt='';WaitingClientsDataTable.lv_resize=function(){for(var i=0;i<5;i++){document.WaitingClientsDataTable.lv_resize_intern()}};document.WaitingClientsDataTable.lv_resize_intern=function(){sc_width=this.getBdContainerEl().offsetWidth-this.getBdContainerEl().clientWidth;clm=this.getColumn('client_nickname_mod');this.setColumnWidth(clm,(document.layout.getSizes().left.w-77-sc_width)/2);clm=this.getColumn('assign_to');this.setColumnWidth(clm,(document.layout.getSizes().left.w-77-sc_width)/2);var tab=document.tabView.get('activeTab');var tab_header_h=tab.get('labelEl').clientHeight;var he=document.layout.getSizes().left.h-93-DOM_Get('notes_id').clientHeight-DOM_Get('links_bar_id').clientHeight-tab_header_h-document.WaitingClientsInfoBar.clientHeight;if(he<150)he=150;DOM_Get('waiting_clients_list').style.height=(he-10)+'px';document.WaitingClientsDataTable.set('height',(he-DOM_Get('waiting_clients_link_bar').clientHeight)+'px');document.WaitingClientsInfoBar.style.width=DOM_Get('waiting_clients_list').style.width;if(typeof(document.WaitingClientsInfoBarResize)!='undefined'){var cld_h=parseInt(document.WaitingClientsDataTable.get('height'),10);var cfn_h=document.WaitingClientsInfoBar.clientHeight;var max_h=cld_h+cfn_h-180;document.WaitingClientsInfoBarResize.set('maxHeight',max_h);if(document.WaitingClientsInfoBarResize.get('height')>max_h+10){document.WaitingClientsInfoBarResize.set('height',max_h-10)}}};var onContextMenuShowWaitingClients=function(p_sType,p_aArgs,p_myDataTable){var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);p_myDataTable.unselectAllRows();if(elRow){p_myDataTable.selectRow(elRow)}this.getItem(0).cfg.setProperty('disabled',document.AnswerButton.get('disabled'));this.getItem(1).cfg.setProperty('disabled',document.DiscardButton.get('disabled'));this.getItem(0).cfg.setProperty('text',TransLang('B100770'));this.getItem(1).cfg.setProperty('text',TransLang('B100780'));var sel_record=document.WaitingClientsDataTable.getRecord(elRow);if(sel_record){if(sel_record.getData('client_flag')*1==300){this.getItem(0).cfg.setProperty('text',TransLang('B100890'));this.getItem(1).cfg.setProperty('text',TransLang('B100690'));this.getItem(0).cfg.setProperty('disabled',false);this.getItem(1).cfg.setProperty('disabled',false)}}};var onContextMenuClickWaitingClients=function(p_sType,p_aArgs,p_myDataTable){var task=p_aArgs[1];if(task){var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);var sel_rows=p_myDataTable.getSelectedRows();if(sel_rows.length==0)return;var sel_record=document.WaitingClientsDataTable.getRecord(sel_rows[0]);if(sel_record){if(sel_record.getData('client_flag')*1==300){switch(task.index){case 0:ArchiveMissedCall(sel_record.getData('client_uniq'));break;case 1:DeleteMissedCall(sel_record.getData('client_uniq'));break}}else{switch(task.index){case 0:StartChat();break;case 1:DiscardChat();break}}}}};var WaitingClientsContextMenu=new YAHOO.widget.ContextMenu("waiting_clients_context_menu",{trigger:document.WaitingClientsDataTable.getContainerEl()});WaitingClientsContextMenu.addItem(TransLang('B100770'));WaitingClientsContextMenu.addItem(TransLang('B100780'));WaitingClientsContextMenu.render('liveadmin');WaitingClientsContextMenu.clickEvent.subscribe(onContextMenuClickWaitingClients,document.WaitingClientsDataTable);WaitingClientsContextMenu.beforeShowEvent.subscribe(onContextMenuShowWaitingClients,document.WaitingClientsDataTable);var WaitingClientsDataTableSelectEvent=function(el,rec){var sel_rows=document.WaitingClientsDataTable.getSelectedRows();var ans=false;var disc=false;var more_info='';if(sel_rows.length>0){var sel_record=document.WaitingClientsDataTable.getRecord(sel_rows[0]);if(sel_record){if(sel_record.getData('btn_ans')=='y')ans=true;if(sel_record.getData('btn_dis')=='y')disc=true;more_info+="<p><strong>"+TransLang('B100510')+":</strong> "+sel_record.getData('client_ip')+"</p>";more_info+="<p><strong>"+TransLang('B100870')+":</strong> "+sel_record.getData('client_signal_p')+"</p>";more_info+="<p><strong>"+TransLang('B100880')+":</strong> "+sel_record.getData('stime')+"</p>";more_info+="<p><strong>"+TransLang('B100620')+":</strong> "+sel_record.getData('client_nickname')+"</p>";more_info+="<p><strong>"+TransLang('B100540')+":</strong> "+sel_record.getData('assign_to')+"</p>";var clidata_client_info=sel_record.getData('client_info');for(var clikey in clidata_client_info){if(clikey.substr(0,1)!='_'){if(clikey=='lv_department_res'){more_info+="<p><strong>"+TransLang('B102180')+":</strong> "+clidata_client_info[clikey]+"</p>"}else{more_info+="<p><strong>"+clikey+":</strong> "+clidata_client_info[clikey]+"</p>"}}}}}if(document.WaitingClientsDataTable.lv_doing_update==false){UpdateWaitingClientsInfoBar(more_info)}document.AnswerButton.set('disabled',!ans);document.DiscardButton.set('disabled',!disc)};WaitingClientsDataTable.subscribe("rowSelectEvent",WaitingClientsDataTableSelectEvent);WaitingClientsDataTable.subscribe("unselectAllRowsEvent",WaitingClientsDataTableSelectEvent);if(LiveAdminConf.can_see_agents=='yes'){var OnlineAgentsColumnDefs=[{key:"agent_nickname_mod",sortable:false,label:TransLang('B100810')},{key:"agent_access_level",sortable:false,label:TransLang('B100830')}];var OnlineAgentsDataSource=new YAHOO.util.DataSource([]);OnlineAgentsDataSource.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;OnlineAgentsDataSource.responseSchema={fields:["agent_nickname_mod","agent_access_level"]};var OnlineAgentsFormatter=function(elTr,oRecord){if(oRecord.getData('agent_is_self')=='y')YAHOO.util.Dom.addClass(elTr,'self_row');else YAHOO.util.Dom.removeClass(elTr,'self_row');if(oRecord.getData('agent_is_online')=='y'){YAHOO.util.Dom.removeClass(elTr,'agent_offline');YAHOO.util.Dom.addClass(elTr,'agent_online')}else{YAHOO.util.Dom.removeClass(elTr,'agent_online');YAHOO.util.Dom.addClass(elTr,'agent_offline')}return true};var OnlineAgentsDataTable=new YAHOO.widget.DataTable("online_agents_list",OnlineAgentsColumnDefs,OnlineAgentsDataSource,{selectionMode:"single",scrollable:true,height:"20em",width:"100%",MSG_EMPTY:TransLang('B100820'),formatRow:OnlineAgentsFormatter});OnlineAgentsDataTable.lv_row_count=0;document.OnlineAgentsDataTable=OnlineAgentsDataTable;OnlineAgentsDataTable.subscribe("rowMouseoverEvent",OnlineAgentsDataTable.onEventHighlightRow);OnlineAgentsDataTable.subscribe("rowMouseoutEvent",OnlineAgentsDataTable.onEventUnhighlightRow);OnlineAgentsDataTable.subscribe("rowClickEvent",OnlineAgentsDataTable.onEventSelectRow);OnlineAgentsDataTable.lv_resize=function(){sc_width=this.getBdContainerEl().offsetWidth-this.getBdContainerEl().clientWidth;clm=this.getColumn('agent_nickname_mod');this.setColumnWidth(clm,(document.layout.getSizes().left.w-76-sc_width)*(2/3));clm=this.getColumn('agent_access_level');this.setColumnWidth(clm,(document.layout.getSizes().left.w-76-sc_width)*(1/3));var tab=document.tabView.get('activeTab');var tab_header_h=tab.get('labelEl').clientHeight;var he=document.layout.getSizes().left.h-93-DOM_Get('notes_id').clientHeight-DOM_Get('links_bar_id').clientHeight-tab_header_h;if(he<150)he=150;DOM_Get('online_agents_list').style.height=(he+35)+'px';document.OnlineAgentsDataTable.set('height',(he+7)+'px')};var onContextMenuShowOnlineAgents=function(p_sType,p_aArgs,p_myDataTable){var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);p_myDataTable.unselectAllRows();if(elRow){p_myDataTable.selectRow(elRow)}this.getItem(0).cfg.setProperty('disabled',true);var sel_record=document.OnlineAgentsDataTable.getRecord(elRow);if(sel_record){if(sel_record.getData('agent_is_self')=='n'&&sel_record.getData('agent_is_online')=='y'&&sel_record.getData('agent_status')=='a'){this.getItem(0).cfg.setProperty('disabled',false)}}};var onContextMenuClickOnlineAgents=function(p_sType,p_aArgs,p_myDataTable){var task=p_aArgs[1];if(task){var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);var sel_rows=p_myDataTable.getSelectedRows();if(sel_rows.length==0)return;if(this.getItem(0).cfg.getProperty('disabled'))return;var sel_record=document.OnlineAgentsDataTable.getRecord(sel_rows[0]);if(sel_record){var agent_userid=sel_record.getData('agent_userid')*1;var agent_nickname=sel_record.getData('agent_nickname');if(agent_userid>100){switch(task.index){case 0:var ch=StartInternChat(agent_userid,agent_nickname);ch.lv.FocusInput();break}}}}};var OnlineAgentsContextMenu=new YAHOO.widget.ContextMenu("online_agents_context_menu",{trigger:document.OnlineAgentsDataTable.getContainerEl()});OnlineAgentsContextMenu.addItem(TransLang('B101530'));OnlineAgentsContextMenu.render('liveadmin');OnlineAgentsContextMenu.clickEvent.subscribe(onContextMenuClickOnlineAgents,document.OnlineAgentsDataTable);OnlineAgentsContextMenu.beforeShowEvent.subscribe(onContextMenuShowOnlineAgents,document.OnlineAgentsDataTable)}if(LiveAdminConf.can_see_visitors=='yes'){var visitors_page_formatter=function(elCell,oRecord,oColumn,oData){elCell.innerHTML='<span style="white-space: nowrap;">'+oRecord.getData("visitor_page")+'</span>'};YAHOO.widget.DataTable.Formatter.visitors_page_formatter=visitors_page_formatter;var VisitorsColumnDefs=[{key:"visitor_loc",sortable:false,label:TransLang('B101650')},{key:"visitor_page",sortable:false,label:TransLang('B101660'),formatter:"visitors_page_formatter"}];var VisitorsDataSource=new YAHOO.util.DataSource([]);VisitorsDataSource.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;VisitorsDataSource.responseSchema={fields:["visitor_loc","visitor_page"]};var VisitorsDataTable=new YAHOO.widget.DataTable("visitors_list",VisitorsColumnDefs,VisitorsDataSource,{selectionMode:"single",scrollable:true,height:"20em",width:"100%",MSG_EMPTY:TransLang('B101670')});VisitorsDataTable.lv_row_count=0;document.VisitorsDataTable=VisitorsDataTable;VisitorsDataTable.subscribe("rowMouseoverEvent",VisitorsDataTable.onEventHighlightRow);VisitorsDataTable.subscribe("rowMouseoutEvent",VisitorsDataTable.onEventUnhighlightRow);VisitorsDataTable.subscribe("rowClickEvent",VisitorsDataTable.onEventSelectRow);VisitorsDataTable.lv_resize=function(){sc_width=this.getBdContainerEl().offsetWidth-this.getBdContainerEl().clientWidth;clm=this.getColumn('visitor_loc');this.setColumnWidth(clm,(document.layout.getSizes().left.w-76-sc_width)*(50/100));clm=this.getColumn('visitor_page');this.setColumnWidth(clm,(document.layout.getSizes().left.w-76-sc_width)*(50/100));var tab=document.tabView.get('activeTab');var tab_header_h=tab.get('labelEl').clientHeight;var lbi=0;if(DOM_Exists('visitors_link_bar_id')){lbi=DOM_Get('visitors_link_bar_id').clientHeight}var he=document.layout.getSizes().left.h-93-DOM_Get('notes_id').clientHeight-DOM_Get('links_bar_id').clientHeight-tab_header_h-lbi;if(he<150)he=150;DOM_Get('visitors_list').style.height=(he+35)+'px';document.VisitorsDataTable.set('height',(he+7)+'px')};var onContextMenuShowVisitors=function(p_sType,p_aArgs,p_myDataTable){CleanupVisitorCallback();var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);p_myDataTable.unselectAllRows();if(elRow){p_myDataTable.selectRow(elRow)}this.getItem(0).cfg.setProperty('disabled',true);var sel_record=document.VisitorsDataTable.getRecord(elRow);if(sel_record&&LiveAdminConf.enable_callback=='yes'){var vip=sel_record.getData('visitor_ip');if(vip!=''&&sel_record.getData('visitor_active')=='n'){var found=false;for(var j in document.lv_visitors_trig){if(vip==document.lv_visitors_trig[j]['ip']){found=true;break}}if(!found){this.getItem(0).cfg.setProperty('disabled',false)}}}};var onContextMenuClickVisitors=function(p_sType,p_aArgs,p_myDataTable){var task=p_aArgs[1];if(task){var elRow=this.contextEventTarget;elRow=p_myDataTable.getTrEl(elRow);var sel_rows=p_myDataTable.getSelectedRows();if(sel_rows.length==0)return;if(this.getItem(0).cfg.getProperty('disabled'))return;var sel_record=document.VisitorsDataTable.getRecord(sel_rows[0]);if(sel_record){var visitor_ip=sel_record.getData('visitor_ip');switch(task.index){case 0:StartVisitorChat(visitor_ip);break}}}};var VisitorsContextMenu=new YAHOO.widget.ContextMenu("visitors_context_menu",{trigger:document.VisitorsDataTable.getContainerEl()});VisitorsContextMenu.addItem(TransLang('B101730'));VisitorsContextMenu.render('liveadmin');VisitorsContextMenu.clickEvent.subscribe(onContextMenuClickVisitors,document.VisitorsDataTable);VisitorsContextMenu.beforeShowEvent.subscribe(onContextMenuShowVisitors,document.VisitorsDataTable)}return{oDS:WaitingClientsDataSource,oDTSingleSelect:WaitingClientsDataTable}};(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event;Event.onDOMReady(function(){var layout=new YAHOO.widget.Layout({units:[{position:'top',height:60,body:'lv_top1',gutter:'0px 0px 0px 0px'},{position:'bottom',height:27,resize:false,gutter:'0px 0px 0px 0px',body:'lv_bottom1'},{position:'left',width:350,resize:true,body:'left1',gutter:'5px',minWidth:250,scroll:false,animate:true},{position:'center',body:'center1',gutter:'5px 5px 5px 0px'}]});document.layout=layout;layout.addListener('resize',function(){document.WaitingClientsDataTable.lv_resize();if(document.OnlineAgentsDataTable&&typeof(document.OnlineAgentsDataTable.lv_resize)=='function'){document.OnlineAgentsDataTable.lv_resize()}if(document.VisitorsDataTable&&typeof(document.VisitorsDataTable.lv_resize)=='function'){document.VisitorsDataTable.lv_resize()}if(typeof(document.chat_layout)=='object'){for(key in document.chat_layout){document.chat_layout[key].resize(true);document.chat_layout[key].lvb_force_resize=true}}if(typeof(document.conf_layout)=='object'){document.conf_layout.resize(true);document.conf_layout.lvb_force_resize=true}if(typeof(document.home_layout)=='object'){document.home_layout.resize(true);document.home_layout.lvb_force_resize=true}if(typeof(document.visitors_layout)=='object'){document.visitors_layout.resize(true);document.visitors_layout.lvb_force_resize=true}if(typeof(document.news_tab)=='object'){document.news_tab.lv_resize()}DOM_Get('left1').style.height=(document.layout.getSizes().left.h-27)+'px';return true});layout.render();var tabView=new YAHOO.widget.TabView('lv_tabs');document.tabView=tabView;tabView.subscribe("activeTabChange",function(){tab=document.tabView.get('activeTab');if(YAHOO.util.Dom.get("text_id_"+tab.sel_client_uniq))YAHOO.util.Dom.get("text_id_"+tab.sel_client_uniq).focus();if(typeof(tab.lv_unblink)=='function')tab.lv_unblink();if(document.chat_DataTable_array[tab.sel_client_uniq])document.chat_DataTable_array[tab.sel_client_uniq].lv_resize();if(typeof(tab.lvb_layout)=='object'){if(typeof(tab.lvb_layout.lvb_force_resize)=='boolean'&&tab.lvb_layout.lvb_force_resize){tab.lvb_layout.resize()}tab.lvb_layout.lvb_force_resize=false}else document.layout.resize(true);if(typeof(document.tabViewTabs)!='undefined'&&document.tabViewTabs['adv_visitors_id']){if(document.tabViewTabs['adv_visitors_id'].get('active'))document.lv_adv_visitors_update_enable=true;else document.lv_adv_visitors_update_enable=false}});layout.getUnitByPosition('top').addClass('lv_top1_cls');layout.getUnitByPosition('bottom').addClass('lv_bottom1_cls');layout.getUnitByPosition('center').addClass('lv_center1_cls');layout.getUnitByPosition('left').addClass('lv_left1_cls');var tabLeftView=new YAHOO.widget.TabView('lv_left_tabs');document.tabLeftView=tabLeftView;var tabLeftCnt='<div class="yui-skin-sam"><div id="waiting_clients_list"></div><div class="waiting_clients_infobar" id="waiting_clients_infobar_id"><div class="waiting_clients_infobar_text" id="waiting_clients_infobar_text_id"></div></div> </div>';tabLeftCnt+='<div class="wc_link_bar" id="waiting_clients_link_bar">';tabLeftCnt+='<input type="button" id="answer_button_id" name="answer_button" value="'+TransLang('B100770')+'"/>';tabLeftCnt+='<input type="button" id="discard_button_id" name="discard_button" value="'+TransLang('B100780')+'"/>';tabLeftCnt+='</div>';var tabLeft=new YAHOO.widget.Tab({label:TransLang('B100760'),content:tabLeftCnt,active:true});document.tabLeftView.addTab(tabLeft);if(LiveAdminConf.can_see_agents=='yes'){var tabLeftCntAgents='<div class="yui-skin-sam"><div id="online_agents_list"></div></div>';var tabLeftAgents=new YAHOO.widget.Tab({label:TransLang('B100790'),content:tabLeftCntAgents,active:false});document.tabLeftView.addTab(tabLeftAgents)}if(LiveAdminConf.can_see_visitors=='yes'){var tabLeftCntVisitors='';if(LiveAdminConf.lite=='y')var tabLeftCntVisitors='<div class="yui-skin-sam"><div id="visitors_list"></div></div>';else var tabLeftCntVisitors='<div id="visitors_link_bar_id" class="visitors_link_bar"><input type="button" id="visitors_button_id" name="visitors_button" value="'+TransLang('B101680')+'"/></div><div class="yui-skin-sam"><div id="visitors_list"></div></div>';var tabLeftVisitors=new YAHOO.widget.Tab({label:TransLang('B101640'),content:tabLeftCntVisitors,active:false});document.tabLeftView.addTab(tabLeftVisitors);document.tabLeftVisitors=tabLeftVisitors}tabLeftView.subscribe("activeTabChange",function(){if(typeof(document.tabLeftVisitors)=='object'&&typeof(document.VisitorsDataTable)=='object'){if(document.tabLeftVisitors.get('active'))document.lv_visitors_update_enable=true;else document.lv_visitors_update_enable=false}});document.lv_visitors_update_enable=false;document.lv_adv_visitors_update_enable=false;InitGlobalLists();document.wait_dialog=new YAHOO.widget.Panel("wait_dialog",{width:"240px",fixedcenter:true,close:false,draggable:true,zindex:4,modal:true,visible:false});document.wait_dialog.setHeader(TransLang('B100560'));document.wait_dialog.setBody("<img src=\"images/wait_dialog.gif\"/>");document.wait_dialog.render(document.body);var AnswerButton=new YAHOO.widget.Button("answer_button_id");AnswerButton.on("click",StartChat);AnswerButton.set('disabled',true);document.AnswerButton=AnswerButton;var DiscardButton=new YAHOO.widget.Button("discard_button_id");DiscardButton.on("click",DiscardChat);DiscardButton.set('disabled',true);document.DiscardButton=DiscardButton;var aConfigButtonMenuClick=function(p_sType,p_aArgs,p_oItem){ConfigGeneralClick(p_oItem.value)};if(LiveAdminConf.access_level=='root'){if(LiveAdminConf.standalone=='n'){var aConfigButtonMenu=[{text:TransLang('B101310'),value:1,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101320'),value:2,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101330'),value:3,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101340'),value:4,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101350'),value:5,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B102110'),value:401,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101360'),value:6,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101370'),value:7,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101380'),value:8,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101390'),value:9,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101410'),value:10,onclick:{fn:aConfigButtonMenuClick}}]}else{var aConfigButtonMenu=[{text:TransLang('B101310'),value:1,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101320'),value:2,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101330'),value:3,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101340'),value:4,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101350'),value:5,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B102110'),value:401,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101360'),value:6,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101370'),value:7,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101410'),value:10,onclick:{fn:aConfigButtonMenuClick}}]}}else{var aConfigButtonMenu=[{text:TransLang('B101320'),value:2,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101360'),value:6,onclick:{fn:aConfigButtonMenuClick}},{text:TransLang('B101370'),value:7,onclick:{fn:aConfigButtonMenuClick}}]}var ConfigButton=new YAHOO.widget.Button("config_button_id",{type:'split',menu:aConfigButtonMenu});ConfigButton.on("click",ConfigPress);document.ConfigButton=ConfigButton;var LogoutButton=new YAHOO.widget.Button("logout_button_id");LogoutButton.on("click",LogoutPress);document.LogoutButton=LogoutButton;if(LiveAdminConf.can_see_visitors=='yes'){var VisitorsButton=new YAHOO.widget.Button("visitors_button_id");VisitorsButton.on("click",VisitorsPress);document.VisitorsButton=VisitorsButton}var OnlineButton=new YAHOO.widget.Button("online_button_id",{type:"checkbox",value:"1",label:TransLang('B100740'),checked:true});if(LiveAdminConf.online_status=='no'){OnlineButton.set('label',TransLang('B100750'));OnlineButton.set('disabled',true);OnlineButton.set('checked',false)}else{OnlineButton.set('label',TransLang('B100740'));OnlineButton.set('disabled',false);OnlineButton.set('checked',true)}OnlineButton.on("click",OnlinePress);document.OnlineButton=OnlineButton;if(!document.tabViewTabs)document.tabViewTabs=new Array();if(!document.chat_layout)document.chat_layout=new Array();if(!document.chat_DataTable_array)document.chat_DataTable_array=new Array();if(!document.conf_dialogs)document.conf_dialogs=new Array();document.lv_notes=DOM_Get('lv_notes_id');if(LiveAdminConf.hide_news=='no'){InitNews()}if(LiveAdminConf.standalone=='y'){CheckLic_v2_init()}InitHome();LoadSoundSystem();SoundObj.ReloadSounds();document.tabView.selectTab(0);document.lv_visitors_trig=new Array();if(LiveAdminConf.demo_mode=='yes'){SimpleDialog(TransLang('B100570'),TransLang('B150170'))}if(LiveAdminConf.standalone=='y'&&LiveAdminConf.access_level=='root'&&LiveAdminConf.check_update=='y'){LiveAdminUpgrade.InitUpgrade()}GetWaitingClients();document.layout.resize();UpdateWaitingClientsInfoBar('')})})();
